para=function(){function e(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)}window.onload=function(){e("	html {  margin: 0;  padding: 0;}body {  background: #FAFAFA;  color: #555;  text-align: center;  margin: 0;  padding: 0;  top: 0;  left: 0;  position: relative;}.pr-stage {  position: fixed;  left: 0;  top: 0;  width: 100%;  height: 100%;  z-index: 100;  opacity: 1;  background-color: #FAFAFA;}.pr-page {  -moz-box-sizing: border-box;  -webkit-box-sizing: border-box;  -o-box-sizing: border-box;  -ms-box-sizing: border-box;  box-sizing: border-box;  overflow: hidden;  width: 100%;  min-height: 300px;  position: relative;}.pr-layer {  width: 100%;  height: 100%;  left: 0;  top: 0;  position: absolute;  z-index: 0;}")};var i,n,r;i=function(t){var e=t&&t.exports||{};return e.define=function(){function t(t,e){Object.keys(e).forEach(function(i){t.prototype[i]=e[i]})}function e(t,e){return e instanceof Array||(e=[e]),e.forEach(function(e){var i="_"+e;void 0===t.prototype[i]&&(t.prototype[i]=null),t.prototype[e]=function(){var t=this;return arguments.length?(t[i]=arguments[0],t):t[i]}}),t}return function(i){var n=function(){var t=this;t.init&&t.init.apply(t,arguments)},r=i.prototype||i.Prototype;r&&(n.prototype=new r);var a=i.properties||i.property||{};t(n,a);var s=i.init;s&&(n.prototype.init=s);var o=i.attrAccessor||i.attrAccessors||[];return e(n,o),n}}(),e.uuid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return[t()+t(),t(),t(),t(),t()+t()+t()].join("-")}}(),e.Query=function(t){if(t){var e=this;t.split("&").forEach(function(t){var i=t.split("="),n=decodeURIComponent(i[0]);e[n]=decodeURIComponent(i[1].replace(/\+/g," "))})}},e.Query.fromLocation=function(){var t=location.search;return t&&new e.Query(t.replace("?",""))},e.toStorage=function(t,e){var i="string"==typeof e,n=i?e:JSON.stringify(e);localStorage.setItem(t,n)},e.fromStorage=function(t){var e=localStorage.getItem(t);return JSON.parse(e)},e.math={},e.ensureIteratable=function(t){switch(t.length){case 0:return null;case 1:var e=t[0];return e instanceof Array?e:[e];default:return Array.prototype.slice.call(t,0)}},e.math.max=function(){for(var t=null,i=e.ensureIteratable(arguments),n=0,r=i.length;r>n;n++){var a=i[n];null===t?t=a:a>t&&(t=a)}return t},e.math.min=function(){for(var t=null,i=e.ensureIteratable(arguments),n=0,r=i.length;r>n;n++){var a=i[n];null===t?t=a:t>a&&(t=a)}return t},e.math.sum=function(){for(var t=0,i=e.ensureIteratable(arguments),n=0,r=i.length;r>n;n++)t+=i[n];return t},e.math.average=function(){var t=e.ensureIteratable(arguments),i=t.length,n=e.math.sum(t);return i?n/i:null},e.composite=function(){var t=Array.prototype.slice.call(arguments,0);return function(){for(var e=this,i=[],n=0,r=t.length;r>n;n++){var a=t[n],s=a&&a.apply(e,arguments);i=i.concat(s)}return i}},e.copy=function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},e.copy.deep=function(t,i){var n=e.copy;if(!t)return i;for(var r in t)t.hasOwnProperty(r)&&(i[r]=t[r]instanceof Date?new Date(t[r]):t[r]instanceof Function?t[r]:t[r]instanceof Array?n.deep(t[r],i[r]||[]):t[r]instanceof Object?n.deep(t[r],i[r]||{}):t[r]);return i},e.crossBrowser=function(t){return t=e.crossBrowser.window(t),t.navigator=e.crossBrowser.navigator(t.navigator||{}),t},e.crossBrowser.window=function(t){return t.requestAnimationFrame=e.crossBrowser.window.dectect.requestAnimationFrame(t),t.URL=e.crossBrowser.window.dectect.URL(t),t},e.crossBrowser.window.dectect={requestAnimationFrame:function(t){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}},URL:function(t){return t.URL||t.webkitURL||t.mozURL||t.msURL}},e.crossBrowser.navigator=function(t){return t.getUserMedia=e.crossBrowser.navigator.detect.getUserMedia(t),t},e.crossBrowser.navigator.detect={getUserMedia:function(t){return t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia}},e.Vector=e.define({init:function(t){var e=this;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},attrAccessor:"".split(","),properties:{add:function(t){var e=this;for(var i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(e[i]+=t[i]);return e},scale:function(t){var e=this;for(var i in e)e.hasOwnProperty(i)&&(e[i]=e[i]*t);return e},revert:function(){var t=this;for(var e in t)t.hasOwnProperty(e)&&(t[e]*=-1);return t},clone:function(){var t=this;return new e.Vector(t)}}}),e.Vector.between=function(t,i){var n=e.Vector;return new n(i).clone().add(new n(t).clone().revert())},e.Animation=e.define({init:function(t,i){var n=e.Vector,r=this;r.from=new n(t),r.to=new n(i),r.scope=n.between(t,i)},attrAccessor:"cursor,frameCount,done".split(","),properties:{_done:!1,_frameCount:100,_cursor:0,value:function(){var t=this,e=t.ease(t._cursor);return t.from.clone().add(t.scope.clone().scale(e))},ease:function(t){return t},next:function(){var t=this,e=t.value();return t.move(1/t._frameCount),e},move:function(t){var e=this;e._cursor+=t,e._cursor>=1&&(e._done=!0,e._cursor=1)},start:function(t,e,i){"function"==typeof arguments[1]&&(i=arguments[1],e=1500);var n=this,r=new Date;n._done=!1,n._cursor=0,function a(){var s=new Date-r;n.move(s/e-n._cursor),i(n.value(),n._done),n._done||t(a)}()}}}),e.toSVG=function(t,e,i){if(void 0===typeof Blob)return null;var n="<svg xmlns='http://www.w3.org/2000/svg' width='"+e+"' height='"+i+"'>"+"<foreignObject width='100%' height='100%'>"+"<div xmlns='http://www.w3.org/1999/xhtml'>"+t+"</div>"+"</foreignObject>"+"</svg>";return new Blob([n],{type:"image/svg+xml;charset=utf-8"})},e.unique=function(t){var e=t instanceof Array;return e||(t=Array.prototype.splice.call(arguments,0)),t.filter(function(e,i){var n=t.indexOf(e);return n===i})},e}("undefined"==typeof module?null:module);var n={};return function(){n={version:"4.7.0",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,UA:function(){var t=navigator.userAgent.toLowerCase(),e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(),Filters:{},Node:function(t){this._init(t)},Shape:function(t){this.__init(t)},Container:function(t){this.__init(t)},Stage:function(t){this.___init(t)},Layer:function(t){this.___init(t)},Group:function(t){this.___init(t)},isDragging:function(){var t=n.DD;return t?t.isDragging:!1},isDragReady:function(){var t=n.DD;return t?!!t.node:!1},_addId:function(t,e){void 0!==e&&(this.ids[e]=t)},_removeId:function(t){void 0!==t&&delete this.ids[t]},_addName:function(t,e){void 0!==e&&(void 0===this.names[e]&&(this.names[e]=[]),this.names[e].push(t))},_removeName:function(t,e){if(void 0!==t){var i=this.names[t];if(void 0!==i){for(var n=0;n<i.length;n++){var r=i[n];r._id===e&&i.splice(n,1)}0===i.length&&delete this.names[t]}}}}}(),function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.returnExports=e()}(this,function(){return n}),function(){n.Collection=function(){var t=[].slice.call(arguments),e=t.length,i=0;for(this.length=e;e>i;i++)this[i]=t[i];return this},n.Collection.prototype=[],n.Collection.prototype.each=function(t){for(var e=0;e<this.length;e++)t(this[e],e)},n.Collection.prototype.toArray=function(){var t,e=[],i=this.length;for(t=0;i>t;t++)e.push(this[t]);return e},n.Collection.toCollection=function(t){var e,i=new n.Collection,r=t.length;for(e=0;r>e;e++)i.push(t[e]);return i},n.Collection.mapMethods=function(t){var e,i=t.length;for(e=0;i>e;e++)!function(e){var i=t[e];n.Collection.prototype[i]=function(){var t,e=this.length;for(args=[].slice.call(arguments),t=0;e>t;t++)this[t][i].apply(this[t],args)}}(e)},n.Transform=function(){this.m=[1,0,0,1,0,0]},n.Transform.prototype={translate:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},scale:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,r=this.m[1]*e+this.m[3]*i,a=this.m[0]*-i+this.m[2]*e,s=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=r,this.m[2]=a,this.m[3]=s},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(t,e){var i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,r=this.m[2]+this.m[0]*t,a=this.m[3]+this.m[1]*t;this.m[0]=i,this.m[1]=n,this.m[2]=r,this.m[3]=a},multiply:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],a=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=s},invert:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,r=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=r,this.m[4]=a,this.m[5]=s},getMatrix:function(){return this.m},setAbsolutePosition:function(t,e){var i=this.m[0],n=this.m[1],r=this.m[2],a=this.m[3],s=this.m[4],o=this.m[5],h=(i*(e-o)-n*(t-s))/(i*a-n*r),c=(t-s-r*h)/i;this.translate(c,h)}};var t="canvas",e="2d",i="[object Array]",r="[object Number]",a="[object String]",s=Math.PI/180,o=180/Math.PI,h="#",c="",l="0",u="Kinetic warning: ",d="Kinetic error: ",f="rgb(",g={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},p=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;n.Util={_isElement:function(t){return!(!t||1!=t.nodeType)},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isObject:function(t){return!!t&&t.constructor==Object},_isArray:function(t){return Object.prototype.toString.call(t)==i},_isNumber:function(t){return Object.prototype.toString.call(t)==r},_isString:function(t){return Object.prototype.toString.call(t)==a},_hasMethods:function(t){var e,i=[];for(e in t)this._isFunction(t[e])&&i.push(e);return i.length>0},_isInDocument:function(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_roundArrValues:function(t){var e,i,r=[],a=t.length,s=n.Util._isNumber;for(e=0;a>e;e++)i=t[e],s(i)&&(i=Math.round(1e3*i)/1e3),r.push(i);return r},_getXY:function(t){if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t)){if(1===t.length){var e=t[0];if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e))return{x:e[0],y:e[1]};if(this._isObject(e))return e}else if(t.length>=2)return{x:t[0],y:t[1]}}else if(this._isObject(t))return t;return null},_getSize:function(t){if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t))if(1===t.length){var e=t[0];if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e)){if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e}else{if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t;return null},_getPoints:function(t){var e,i,n=[];if(void 0===t)return[];if(i=t.length,this._isArray(t[0])){for(e=0;i>e;e++)n.push({x:t[e][0],y:t[e][1]});return n}if(this._isObject(t[0]))return t;for(e=0;i>e;e+=2)n.push({x:t[e],y:t[e+1]});return n},_getImage:function(i,n){var r,a,s;i?this._isElement(i)?n(i):this._isString(i)?(r=new Image,r.onload=function(){n(r)},r.src=i):i.data?(a=document.createElement(t),a.width=i.width,a.height=i.height,_context=a.getContext(e),_context.putImageData(i,0,0),s=a.toDataURL(),r=new Image,r.onload=function(){n(r)},r.src=s):n(null):n(null)},_rgbToHex:function(t,e,i){return((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},_hexToRgb:function(t){t=t.replace(h,c);var e=parseInt(t,16);return{r:255&e>>16,g:255&e>>8,b:255&e}},getRandomColor:function(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t=l+t;return h+t},get:function(t,e){return void 0===t?e:t},getRGB:function(t){var e;return t in g?(e=g[t],{r:e[0],g:e[1],b:e[2]}):t[0]===h?this._hexToRgb(t.substring(1)):t.substr(0,4)===f?(e=p.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},_merge:function(t,e){var i=this._clone(e);for(var n in t)i[n]=this._isObject(t[n])?this._merge(t[n],i[n]):t[n];return i},_clone:function(t){var e={};for(var i in t)e[i]=this._isObject(t[i])?this._clone(t[i]):t[i];return e},_degToRad:function(t){return t*s},_radToDeg:function(t){return t*o},_capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},error:function(t){throw new Error(d+t)},warn:function(t){window.console&&console.warn&&console.warn(u+t)},extend:function(t,e){for(var i in e.prototype)i in t.prototype||(t.prototype[i]=e.prototype[i])},addMethods:function(t,e){var i;for(i in e)t.prototype[i]=e[i]},_getControlPoints:function(t,e,i,n){var r=t.x,a=t.y,s=e.x,o=e.y,h=i.x,c=i.y,l=Math.sqrt(Math.pow(s-r,2)+Math.pow(o-a,2)),u=Math.sqrt(Math.pow(h-s,2)+Math.pow(c-o,2)),d=n*l/(l+u),f=n*u/(l+u),g=s-d*(h-r),p=o-d*(c-a),v=s+f*(h-r),m=o+f*(c-a);return[{x:g,y:p},{x:v,y:m}]},_expandPoints:function(t,e){var i,r,a=t.length,s=[];for(i=1;a-1>i;i++)r=n.Util._getControlPoints(t[i-1],t[i],t[i+1],e),s.push(r[0]),s.push(t[i]),s.push(r[1]);return s},_removeLastLetter:function(t){return t.substring(0,t.length-1)}}}(),function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=window.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,a=i/r;n.Canvas=function(t){this.init(t)},n.Canvas.prototype={init:function(t){t=t||{};var e=t.pixelRatio||n.pixelRatio||a;this.pixelRatio=e,this._canvas=document.createElement("canvas"),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(t){this.pixelRatio=t,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px"},setHeight:function(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(t,e){this.setWidth(t),this.setHeight(e)},toDataURL:function(t,e){try{return this._canvas.toDataURL(t,e)}catch(i){try{return this._canvas.toDataURL()}catch(r){return n.Util.warn("Unable to get data URL. "+r.message),""}}}},n.SceneCanvas=function(t){t=t||{};var e=t.width||0,i=t.height||0;n.Canvas.call(this,t),this.context=new n.SceneContext(this),this.setSize(e,i)},n.SceneCanvas.prototype={setWidth:function(t){var e=this.pixelRatio,i=this.getContext()._context;n.Canvas.prototype.setWidth.call(this,t),i.scale(e,e)},setHeight:function(t){var e=this.pixelRatio,i=this.getContext()._context;n.Canvas.prototype.setHeight.call(this,t),i.scale(e,e)}},n.Util.extend(n.SceneCanvas,n.Canvas),n.HitCanvas=function(t){t=t||{};var e=t.width||0,i=t.height||0;n.Canvas.call(this,t),this.context=new n.HitContext(this),this.setSize(e,i)},n.Util.extend(n.HitCanvas,n.Canvas)}(),function(){var t=",",e="(",i=")",r="([",a="])",s=";",o="()",h="=",c=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];n.Context=function(t){this.init(t)},n.Context.prototype={init:function(t){this.canvas=t,this._context=t._canvas.getContext("2d"),n.enableTrace&&(this.traceArr=[],this._enableTrace())},getTrace:function(c){var l,u,d,f,g=this.traceArr,p=g.length,v="";for(l=0;p>l;l++)u=g[l],d=u.method,d?(f=u.args,v+=d,v+=c?o:n.Util._isArray(f[0])?r+f.join(t)+a:e+f.join(t)+i):(v+=u.property,c||(v+=h+u.val)),v+=s;return v},clearTrace:function(){this.traceArr=[]},_trace:function(t){var e,i=this.traceArr;i.push(t),e=i.length,e>=n.traceArrMax&&i.shift()},reset:function(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)},getCanvas:function(){return this.canvas},clear:function(t){var e,i,r=this.getCanvas();t?(e=n.Util._getXY(t),i=n.Util._getSize(t),this.clearRect(e.x||0,e.y||0,i.width,i.height)):this.clearRect(0,0,r.getWidth(),r.getHeight())},fillShape:function(t){t.getFillEnabled()&&this._fill(t)},strokeShape:function(t){t.getStrokeEnabled()&&this._stroke(t)},fillStrokeShape:function(t){var e=t.getFillEnabled();e&&this._fill(t),t.getStrokeEnabled()&&this._stroke(t,t.hasShadow()&&t.hasFill()&&e)},_applyLineCap:function(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)},_applyOpacity:function(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)},_applyLineJoin:function(t){var e=t.getLineJoin();e&&this.setAttr("lineJoin",e)},_applyAncestorTransforms:function(t){var e=t.getAbsoluteTransform().getMatrix();this.transform(e[0],e[1],e[2],e[3],e[4],e[5])},_clip:function(t){var e=t.getClipX()||0,i=t.getClipY()||0,n=t.getClipWidth(),r=t.getClipHeight();this.save(),this._applyAncestorTransforms(t),this.beginPath(),this.rect(e,i,n,r),this.clip(),this.reset(),t._drawChildren(this.getCanvas()),this.restore()},setAttr:function(t,e){this._context[t]=e},arc:function(){var t=arguments;this._context.arc(t[0],t[1],t[2],t[3],t[4],t[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var t=arguments;this._context.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5])},clearRect:function(){var t=arguments;this._context.clearRect(t[0],t[1],t[2],t[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createLinearGradient:function(){var t=arguments;return this._context.createLinearGradient(t[0],t[1],t[2],t[3])},createPattern:function(){var t=arguments;return this._context.createPattern(t[0],t[1])},createRadialGradient:function(){var t=arguments;return this._context.createRadialGradient(t[0],t[1],t[2],t[3],t[4],t[5])},drawImage:function(){var t=arguments,e=this._context;3===t.length?e.drawImage(t[0],t[1],t[2]):5===t.length?e.drawImage(t[0],t[1],t[2],t[3],t[4]):9===t.length&&e.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},fill:function(){this._context.fill()},fillText:function(){var t=arguments;this._context.fillText(t[0],t[1],t[2])},getImageData:function(){var t=arguments;return this._context.getImageData(t[0],t[1],t[2],t[3])},lineTo:function(){var t=arguments;this._context.lineTo(t[0],t[1])},moveTo:function(){var t=arguments;this._context.moveTo(t[0],t[1])},rect:function(){var t=arguments;this._context.rect(t[0],t[1],t[2],t[3])},putImageData:function(){var t=arguments;this._context.putImageData(t[0],t[1],t[2])},quadraticCurveTo:function(){var t=arguments;this._context.quadraticCurveTo(t[0],t[1],t[2],t[3])},restore:function(){this._context.restore()},rotate:function(){var t=arguments;this._context.rotate(t[0])},save:function(){this._context.save()},scale:function(){var t=arguments;this._context.scale(t[0],t[1])},setLineDash:function(){var t=arguments,e=this._context;this._context.setLineDash?e.setLineDash(t[0]):"mozDash"in e?e.mozDash=t[0]:"webkitLineDash"in e&&(e.webkitLineDash=t[0])},setTransform:function(){var t=arguments;this._context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},stroke:function(){this._context.stroke()},strokeText:function(){var t=arguments;this._context.strokeText(t[0],t[1],t[2])},transform:function(){var t=arguments;this._context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},translate:function(){var t=arguments;this._context.translate(t[0],t[1])},_enableTrace:function(){var t,e,i=this,r=c.length,a=n.Util._roundArrValues,s=this.setAttr;for(t=0;r>t;t++)!function(t){var n,r=i[t];i[t]=function(){return e=a(Array.prototype.slice.call(arguments,0)),n=r.apply(i,arguments),i._trace({method:t,args:e}),n}}(c[t]);i.setAttr=function(){s.apply(i,arguments),i._trace({property:arguments[0],val:arguments[1]})}}},n.SceneContext=function(t){n.Context.call(this,t)},n.SceneContext.prototype={_fillColor:function(t){var e=t.getFill();this.setAttr("fillStyle",e),t._fillFunc(this)},_fillPattern:function(t){var e=t.getFillPatternImage(),i=t.getFillPatternX(),n=t.getFillPatternY(),r=t.getFillPatternScale(),a=t.getFillPatternRotation(),s=t.getFillPatternOffset(),o=t.getFillPatternRepeat();(i||n)&&this.translate(i||0,n||0),a&&this.rotate(a),r&&this.scale(r.x,r.y),s&&this.translate(-1*s.x,-1*s.y),this.setAttr("fillStyle",this.createPattern(e,o||"repeat")),this.fill()},_fillLinearGradient:function(t){var e=t.getFillLinearGradientStartPoint(),i=t.getFillLinearGradientEndPoint(),n=t.getFillLinearGradientColorStops(),r=this.createLinearGradient(e.x,e.y,i.x,i.y);if(n){for(var a=0;a<n.length;a+=2)r.addColorStop(n[a],n[a+1]);this.setAttr("fillStyle",r),this.fill()}},_fillRadialGradient:function(t){for(var e=t.getFillRadialGradientStartPoint(),i=t.getFillRadialGradientEndPoint(),n=t.getFillRadialGradientStartRadius(),r=t.getFillRadialGradientEndRadius(),a=t.getFillRadialGradientColorStops(),s=this.createRadialGradient(e.x,e.y,n,i.x,i.y,r),o=0;o<a.length;o+=2)s.addColorStop(a[o],a[o+1]);this.setAttr("fillStyle",s),this.fill()},_fill:function(t,e){var i=t.getFill(),n=t.getFillPatternImage(),r=t.getFillLinearGradientColorStops(),a=t.getFillRadialGradientColorStops(),s=t.getFillPriority();!e&&t.hasShadow()&&(this.save(),this._applyShadow(t)),i&&"color"===s?this._fillColor(t):n&&"pattern"===s?this._fillPattern(t):r&&"linear-gradient"===s?this._fillLinearGradient(t):a&&"radial-gradient"===s?this._fillRadialGradient(t):i?this._fillColor(t):n?this._fillPattern(t):r?this._fillLinearGradient(t):a&&this._fillRadialGradient(t),!e&&t.hasShadow()&&(this.restore(),this._fill(t,!0))},_stroke:function(t,e){var i=t.getStroke(),n=t.getStrokeWidth(),r=t.getDashArray(),a=t.getStrokeScaleEnabled();(i||n)&&(a||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(t),r&&t.getDashArrayEnabled()&&this.setLineDash(r),!e&&t.hasShadow()&&this._applyShadow(t),this.setAttr("lineWidth",n||2),this.setAttr("strokeStyle",i||"black"),t._strokeFunc(this),!e&&t.hasShadow()&&this._stroke(t,!0),a||this.restore())},applyShadow:function(t,e){this.save(),this._applyShadow(t),e(),this.restore(),e()},_applyShadow:function(t){var e,i,r,a,s,o;t.hasShadow()&&t.getShadowEnabled()&&(e=n.Util,i=t.getAbsoluteOpacity(),r=e.get(t.getShadowColor(),"black"),a=e.get(t.getShadowBlur(),5),o=e.get(t.getShadowOpacity(),0),s=e.get(t.getShadowOffset(),{x:0,y:0}),o&&this.setAttr("globalAlpha",o*i),this.setAttr("shadowColor",r),this.setAttr("shadowBlur",a),this.setAttr("shadowOffsetX",s.x),this.setAttr("shadowOffsetY",s.y))}},n.Util.extend(n.SceneContext,n.Context),n.HitContext=function(t){n.Context.call(this,t)},n.HitContext.prototype={_fill:function(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()},_stroke:function(t){var e=t.getStroke(),i=t.getStrokeWidth();(e||i)&&(this._applyLineCap(t),this.setAttr("lineWidth",i||2),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this))}},n.Util.extend(n.HitContext,n.Context)}(),function(){var t="add",e="b",i="Deg",r="g",a="get",s="#",o="r",h="RGB",c="set",l="B",u="G",d="Height",f="R",g="Width",p="X",v="Y";n.Factory={addGetterSetter:function(t,e,i){this.addGetter(t,e,i),this.addSetter(t,e)},addPointGetterSetter:function(t,e,i){this.addPointGetter(t,e,i),this.addPointSetter(t,e),this.addGetter(t,e+p,i),this.addGetter(t,e+v,i),this.addSetter(t,e+p),this.addSetter(t,e+v)},addBoxGetterSetter:function(t,e,i){this.addBoxGetter(t,e,i),this.addBoxSetter(t,e),this.addGetter(t,e+p,i),this.addGetter(t,e+v,i),this.addGetter(t,e+g,i),this.addGetter(t,e+d,i),this.addSetter(t,e+p),this.addSetter(t,e+v),this.addSetter(t,e+g),this.addSetter(t,e+d)},addPointsGetterSetter:function(t,e){this.addPointsGetter(t,e),this.addPointsSetter(t,e),this.addPointAdder(t,e)},addRotationGetterSetter:function(t,e,i){this.addRotationGetter(t,e,i),this.addRotationSetter(t,e)},addColorGetterSetter:function(t,i){this.addGetter(t,i),this.addSetter(t,i),this.addColorRGBGetter(t,i),this.addColorComponentGetter(t,i,o),this.addColorComponentGetter(t,i,r),this.addColorComponentGetter(t,i,e),this.addColorRGBSetter(t,i),this.addColorComponentSetter(t,i,o),this.addColorComponentSetter(t,i,r),this.addColorComponentSetter(t,i,e)},addColorRGBGetter:function(t,e){var i=a+n.Util._capitalize(e)+h;t.prototype[i]=function(){return n.Util.getRGB(this.attrs[e])}},addColorComponentGetter:function(t,e,i){var r=a+n.Util._capitalize(e),s=r+n.Util._capitalize(i);t.prototype[s]=function(){return this[r+h]()[i]}},addPointsGetter:function(t,e){var i=a+n.Util._capitalize(e);t.prototype[i]=function(){var t=this.attrs[e];return void 0===t?[]:t}},addGetter:function(t,e,i){var r=a+n.Util._capitalize(e);t.prototype[r]=function(){var t=this.attrs[e];return void 0===t?i:t}},addPointGetter:function(t,e){var i=a+n.Util._capitalize(e);t.prototype[i]=function(){var t=this;return{x:t[i+p](),y:t[i+v]()}}},addBoxGetter:function(t,e){var i=a+n.Util._capitalize(e);t.prototype[i]=function(){var t=this;return{x:t[i+p](),y:t[i+v](),width:t[i+g](),height:t[i+d]()}}},addRotationGetter:function(t,e,r){var s=a+n.Util._capitalize(e);t.prototype[s]=function(){var t=this.attrs[e];return void 0===t&&(t=r),t},t.prototype[s+i]=function(){var t=this.attrs[e];return void 0===t&&(t=r),n.Util._radToDeg(t)}},addColorRGBSetter:function(t,e){var i=c+n.Util._capitalize(e)+h;t.prototype[i]=function(t){var i=t&&void 0!==t.r?0|t.r:this.getAttr(e+f),r=t&&void 0!==t.g?0|t.g:this.getAttr(e+u),a=t&&void 0!==t.b?0|t.b:this.getAttr(e+l);this._setAttr(e,s+n.Util._rgbToHex(i,r,a))}},addColorComponentSetter:function(t,e,i){var r=c+n.Util._capitalize(e),a=r+n.Util._capitalize(i);t.prototype[a]=function(t){var e={};e[i]=t,this[r+h](e)}},addPointsSetter:function(t,e){var i=c+n.Util._capitalize(e);t.prototype[i]=function(t){var e=n.Util._getPoints(t);this._setAttr("points",e)}},addSetter:function(t,e){var i=c+n.Util._capitalize(e);t.prototype[i]=function(t){this._setAttr(e,t)}},addPointSetter:function(t,e){var i=c+n.Util._capitalize(e);t.prototype[i]=function(){var t=n.Util._getXY([].slice.call(arguments)),r=this.attrs[e],a=0,s=0;t&&(a=t.x,s=t.y,this._fireBeforeChangeEvent(e,r,t),void 0!==a&&this[i+p](a),void 0!==s&&this[i+v](s),this._fireChangeEvent(e,r,t))}},addBoxSetter:function(t,e){var i=c+n.Util._capitalize(e);t.prototype[i]=function(){var t,r,a,s,o=[].slice.call(arguments),h=n.Util._getXY(o),c=n.Util._getSize(o),l=n.Util._merge(h,c),u=this.attrs[e];l&&(t=l.x,r=l.y,a=l.width,s=l.height,this._fireBeforeChangeEvent(e,u,l),void 0!==t&&this[i+p](t),void 0!==r&&this[i+v](r),void 0!==a&&this[i+g](a),void 0!==s&&this[i+d](s),this._fireChangeEvent(e,u,l))}},addRotationSetter:function(t,e){var r=c+n.Util._capitalize(e);t.prototype[r]=function(t){this._setAttr(e,t)},t.prototype[r+i]=function(t){this._setAttr(e,n.Util._degToRad(t))}},addPointAdder:function(e,i){var r=t+n.Util._removeLastLetter(n.Util._capitalize(i));e.prototype[r]=function(){var t=n.Util._getXY([].slice.call(arguments)),e=this.attrs[i];t&&(this._fireBeforeChangeEvent(i,e,t),this.attrs[i].push(t),this._fireChangeEvent(i,e,t))}}}}(),function(){var t="absoluteOpacity",e="absoluteTransform",i="before",r="Change",a="children",s=".",o="",h="get",c="id",l="kinetic",u="listening",d="mouseenter",f="mouseleave",g="name",p="set",v="Shape",m=" ",_="stage",y="transform",w="Stage",x="visible",S=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic"].join(m);n.Util.addMethods(n.Node,{_init:function(i){var r=this;this._id=n.idCounter++,this.eventListeners={},this.attrs={},this.cache={},this.setAttrs(i),this.on(S,function(){this._clearCache(y),r._clearSelfAndChildrenCache(e)}),this.on("visibleChange.kinetic",function(){r._clearSelfAndChildrenCache(x)}),this.on("listeningChange.kinetic",function(){r._clearSelfAndChildrenCache(u)}),this.on("opacityChange.kinetic",function(){r._clearSelfAndChildrenCache(t)})},clearCache:function(){this.cache={}},_clearCache:function(t){delete this.cache[t]},_getCache:function(t,e){var i=this.cache[t];return void 0===i&&(this.cache[t]=e.call(this)),this.cache[t]},_clearSelfAndChildrenCache:function(t){this._clearCache(t),this.children&&this.getChildren().each(function(e){e._clearSelfAndChildrenCache(t)})},on:function(t,e){var i,n,r,a,h,c=t.split(m),l=c.length;for(i=0;l>i;i++)n=c[i],r=n.split(s),a=r[0],h=r[1]||o,this.eventListeners[a]||(this.eventListeners[a]=[]),this.eventListeners[a].push({name:h,handler:e});return this},off:function(t){var e,i,n,r,a,o,h=t.split(m),c=h.length;for(e=0;c>e;e++)if(n=h[e],r=n.split(s),a=r[0],o=r[1],a)this.eventListeners[a]&&this._off(a,o);else for(i in this.eventListeners)this._off(i,o);return this},remove:function(){var i=this.getParent();return i&&i.children&&(i.children.splice(this.index,1),i._setChildrenIndices(),delete this.parent),this._clearSelfAndChildrenCache(_),this._clearSelfAndChildrenCache(e),this._clearSelfAndChildrenCache(x),this._clearSelfAndChildrenCache(u),this._clearSelfAndChildrenCache(t),this},destroy:function(){n._removeId(this.getId()),n._removeName(this.getName(),this._id),this.remove()},getAttr:function(t){var e=h+n.Util._capitalize(t);return n.Util._isFunction(this[e])?this[e]():this.attrs[t]},getAncestors:function(){for(var t=this.getParent(),e=new n.Collection;t;)e.push(t),t=t.getParent();return e},setAttr:function(){var t=Array.prototype.slice.call(arguments),e=t[0],i=p+n.Util._capitalize(e),r=this[i];return t.shift(),n.Util._isFunction(r)?r.apply(this,t):this.attrs[e]=t[0],this},getAttrs:function(){return this.attrs||{}},setAttrs:function(t){var e,i;if(t)for(e in t)e===a||(i=p+n.Util._capitalize(e),n.Util._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]));return this},isListening:function(){return this._getCache(u,this._isListening)},_isListening:function(){var t=this.getListening(),e=this.getParent();return t&&e&&!e.isListening()?!1:t},isVisible:function(){return this._getCache(x,this._isVisible)},_isVisible:function(){var t=this.getVisible(),e=this.getParent();return t&&e&&!e.isVisible()?!1:t},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function t(h){for(e=[],i=h.length,n=0;i>n;n++)r=h[n],o++,r.nodeType!==v&&(e=e.concat(r.getChildren().toArray())),r._id===s._id&&(n=i);e.length>0&&e[0].getLevel()<=a&&t(e)}var e,i,n,r,a=this.getLevel(),s=this,o=0;return s.nodeType!==w&&t(s.getStage().getChildren()),o},getLevel:function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},setPosition:function(){var t=n.Util._getXY([].slice.call(arguments));return this.setX(t.x),this.setY(t.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var t=this.getAbsoluteTransform().getMatrix(),e=new n.Transform,i=this.getOffset();return e.m=t.slice(),e.translate(i.x,i.y),e.getTranslation()},setAbsolutePosition:function(){var t,e=n.Util._getXY([].slice.call(arguments)),i=this._clearTransform();return this.attrs.x=i.x,this.attrs.y=i.y,delete i.x,delete i.y,t=this.getAbsoluteTransform(),t.invert(),t.translate(e.x,e.y),e={x:this.attrs.x+t.getTranslation().x,y:this.attrs.y+t.getTranslation().y},this.setPosition(e.x,e.y),this._setTransform(i),this
},_setTransform:function(t){var i;for(i in t)this.attrs[i]=t[i];this._clearCache(y),this._clearSelfAndChildrenCache(e)},_clearTransform:function(){var t={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(y),this._clearSelfAndChildrenCache(e),t},move:function(){var t=n.Util._getXY([].slice.call(arguments)),e=this.getX(),i=this.getY();return void 0!==t.x&&(e+=t.x),void 0!==t.y&&(i+=t.y),this.setPosition(e,i),this},_eachAncestorReverse:function(t,e){var i,n,r=[],a=this.getParent();for(e&&r.unshift(this);a;)r.unshift(a),a=a.parent;for(i=r.length,n=0;i>n;n++)t(r[n])},rotate:function(t){return this.setRotation(this.getRotation()+t),this},rotateDeg:function(t){return this.setRotation(this.getRotation()+n.Util._degToRad(t)),this},moveToTop:function(){var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var t=this.index,e=this.parent.getChildren().length;return e-1>t?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(t){var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(t,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var t=this.getOpacity();return this.getParent()&&(t*=this.getParent().getAbsoluteOpacity()),t},moveTo:function(t){return n.Node.prototype.remove.call(this),t.add(this),this},toObject:function(){var t,e,i=n.Util,r={},a=this.getAttrs();r.attrs={};for(t in a)e=a[t],i._isFunction(e)||i._isElement(e)||i._isObject(e)&&i._hasMethods(e)||(r.attrs[t]=e);return r.className=this.getClassName(),r},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this._getCache(_,this._getStage)},_getStage:function(){var t=this.getParent();return t?t.getStage():void 0},fire:function(t,e,i){return i?this._fireAndBubble(t,e||{}):this._fire(t,e||{}),this},getAbsoluteTransform:function(){return this._getCache(e,this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var t,e=new n.Transform;return this._eachAncestorReverse(function(i){t=i.getTransform(),e.multiply(t)},!0),e},_getTransform:function(){var t=new n.Transform,e=this.getX(),i=this.getY(),r=this.getRotation(),a=this.getScaleX(),s=this.getScaleY(),o=this.getSkewX(),h=this.getSkewY(),c=this.getOffsetX(),l=this.getOffsetY();return(0!==e||0!==i)&&t.translate(e,i),0!==r&&t.rotate(r),(0!==o||0!==h)&&t.skew(o,h),(1!==a||1!==s)&&t.scale(a,s),(0!==c||0!==l)&&t.translate(-1*c,-1*l),t},clone:function(t){var e,i,r,a,s,o=this.getClassName(),h=new n[o](this.attrs);for(e in this.eventListeners)for(i=this.eventListeners[e],r=i.length,a=0;r>a;a++)s=i[a],s.name.indexOf(l)<0&&(h.eventListeners[e]||(h.eventListeners[e]=[]),h.eventListeners[e].push(s));return h.setAttrs(t),h},toDataURL:function(t){t=t||{};var e=t.mimeType||null,i=t.quality||null,r=this.getStage(),a=t.x||0,s=t.y||0,o=new n.SceneCanvas({width:t.width||r.getWidth(),height:t.height||r.getHeight(),pixelRatio:1}),h=o.getContext();return h.save(),(a||s)&&h.translate(-1*a,-1*s),this.drawScene(o),h.restore(),o.toDataURL(e,i)},toImage:function(t){n.Util._getImage(this.toDataURL(t),function(e){t.callback(e)})},setSize:function(){var t=n.Util._getSize(Array.prototype.slice.call(arguments));return this.setWidth(t.width),this.setHeight(t.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(t){return this.nodeType===t?[this]:[]},_off:function(t,e){var i,n,r=this.eventListeners[t];for(i=0;i<r.length;i++)if(n=r[i].name,!("kinetic"===n&&"kinetic"!==e||e&&n!==e)){if(r.splice(i,1),0===r.length){delete this.eventListeners[t];break}i--}},_fireBeforeChangeEvent:function(t,e,a){this._fire(i+n.Util._capitalize(t)+r,{oldVal:e,newVal:a})},_fireChangeEvent:function(t,e,i){this._fire(t+r,{oldVal:e,newVal:i})},setId:function(t){var e=this.getId();return n._removeId(e),n._addId(this,t),this._setAttr(c,t),this},setName:function(t){var e=this.getName();return n._removeName(e,this._id),n._addName(this,t),this._setAttr(g,t),this},_setAttr:function(t,e){var i;void 0!==e&&(i=this.attrs[t],this._fireBeforeChangeEvent(t,i,e),this.attrs[t]=e,this._fireChangeEvent(t,i,e))},_fireAndBubble:function(t,e,i){var n=!0;e&&this.nodeType===v&&(e.targetNode=this),t===d&&i&&this._id===i._id?n=!1:t===f&&i&&this._id===i._id&&(n=!1),n&&(this._fire(t,e),e&&!e.cancelBubble&&this.parent&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i.parent):this._fireAndBubble.call(this.parent,t,e)))},_fire:function(t,e){var i,n,r=this.eventListeners[t];if(r)for(i=r.length,n=0;i>n;n++)r[n].handler.call(this,e)},draw:function(){return this.drawScene(),this.drawHit(),this},shouldDrawHit:function(){return this.isListening()&&this.isVisible()&&!n.isDragging()},isDraggable:function(){return!1},getTransform:function(){return this._getCache(y,this._getTransform)}}),n.Node.create=function(t,e){return this._createNode(JSON.parse(t),e)},n.Node._createNode=function(t,e){var i,r,a,s=n.Node.prototype.getClassName.call(t),o=t.children;if(e&&(t.attrs.container=e),i=new n[s](t.attrs),o)for(r=o.length,a=0;r>a;a++)i.add(this._createNode(o[a]));return i},n.Factory.addGetterSetter(n.Node,"x",0),n.Factory.addGetterSetter(n.Node,"y",0),n.Factory.addGetterSetter(n.Node,"opacity",1),n.Factory.addGetter(n.Node,"name"),n.Factory.addGetter(n.Node,"id"),n.Factory.addRotationGetterSetter(n.Node,"rotation",0),n.Factory.addPointGetterSetter(n.Node,"scale",1),n.Factory.addPointGetterSetter(n.Node,"skew",0),n.Factory.addPointGetterSetter(n.Node,"offset",0),n.Factory.addSetter(n.Node,"width"),n.Factory.addSetter(n.Node,"height"),n.Factory.addGetterSetter(n.Node,"listening",!0),n.Factory.addGetterSetter(n.Node,"visible",!0),n.Collection.mapMethods(["on","off","remove","destroy","show","hide","move","rotate","moveToTop","moveUp","moveDown","moveToBottom","moveTo","fire","draw"])}(),function(){function t(t){window.setTimeout(t,1e3/60)}var e=500;n.Animation=function(t,e){this.func=t,this.setLayers(e),this.id=n.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},n.Animation.prototype={setLayers:function(t){var e=[];e=t?t.length>0?t:[t]:[],this.layers=e},getLayers:function(){return this.layers},addLayer:function(t){var e,i,n=this.layers;if(n){for(e=n.length,i=0;e>i;i++)if(n[i]._id===t._id)return!1}else this.layers=[];return this.layers.push(t),!0},isRunning:function(){for(var t=n.Animation,e=t.animations,i=0;i<e.length;i++)if(e[i].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),n.Animation._addAnimation(this)},stop:function(){n.Animation._removeAnimation(this)},_updateFrameObject:function(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},n.Animation.animations=[],n.Animation.animIdCounter=0,n.Animation.animRunning=!1,n.Animation._addAnimation=function(t){this.animations.push(t),this._handleAnimation()},n.Animation._removeAnimation=function(t){for(var e=t.id,i=this.animations,n=i.length,r=0;n>r;r++)if(i[r].id===e){this.animations.splice(r,1);break}},n.Animation._runFrames=function(){var t,e,i,n,r,a,s,o,h={},c=this.animations;for(n=0;n<c.length;n++){for(t=c[n],e=t.layers,i=t.func,t._updateFrameObject((new Date).getTime()),a=e.length,r=0;a>r;r++)s=e[r],void 0!==s._id&&(h[s._id]=s);i&&i.call(t,t.frame)}for(o in h)h[o].draw()},n.Animation._animationLoop=function(){var t=this;this.animations.length>0?(this._runFrames(),n.Animation.requestAnimFrame(function(){t._animationLoop()})):this.animRunning=!1},n.Animation._handleAnimation=function(){var t=this;this.animRunning||(this.animRunning=!0,t._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||t}(),n.Animation.requestAnimFrame=function(e){var i=n.DD&&n.DD.isDragging?t:RAF;i(e)};var i=n.Node.prototype.moveTo;n.Node.prototype.moveTo=function(t){i.call(this,t)},n.Layer.prototype.batchDraw=function(){var t=this;this.batchAnim||(this.batchAnim=new n.Animation(function(){t.lastBatchDrawTime&&(new Date).getTime()-t.lastBatchDrawTime>e&&t.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},n.Stage.prototype.batchDraw=function(){this.getChildren().each(function(t){t.batchDraw()})}}(),function(){var t={node:1,duration:1,easing:1,onFinish:1,yoyo:1},e=1,i=2,r=3,a=0;n.Tween=function(e){var i,r=this,o=e.node,h=o._id,c=e.duration||1,l=e.easing||n.Easings.Linear,u=!!e.yoyo;this.node=o,this._id=a++,this.anim=new n.Animation(function(){r.tween.onEnterFrame()},o.getLayer()||o.getLayers()),this.tween=new s(i,function(t){r._tweenFunc(t)},l,0,1,1e3*c,u),this._addListeners(),n.Tween.attrs[h]||(n.Tween.attrs[h]={}),n.Tween.attrs[h][this._id]||(n.Tween.attrs[h][this._id]={}),n.Tween.tweens[h]||(n.Tween.tweens[h]={});for(i in e)void 0===t[i]&&this._addAttr(i,e[i]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset},n.Tween.attrs={},n.Tween.tweens={},n.Tween.prototype={_addAttr:function(t,e){var i,r,a,s,o,h,c,l=this.node,u=l._id;if(a=n.Tween.tweens[u][t],a&&delete n.Tween.attrs[u][a][t],i=l.getAttr(t),n.Util._isArray(e))for(e=n.Util._getPoints(e),r=[],o=e.length,s=0;o>s;s++)h=i[s],c=e[s],r.push({x:c.x-h.x,y:c.y-h.y});else r=e-i;n.Tween.attrs[u][this._id][t]={start:i,diff:r},n.Tween.tweens[u][t]=this._id},_tweenFunc:function(t){var e,i,r,a,s,o,h,c,l,u=this.node,d=n.Tween.attrs[u._id][this._id];for(e in d){if(i=d[e],r=i.start,a=i.diff,n.Util._isArray(r))for(s=[],h=r.length,o=0;h>o;o++)c=r[o],l=a[o],s.push({x:c.x+l.x*t,y:c.y+l.y*t});else s=r+a*t;u.setAttr(e,s)}},_addListeners:function(){var t=this;this.tween.onPlay=function(){t.anim.start()},this.tween.onReverse=function(){t.anim.start()},this.tween.onPause=function(){t.anim.stop()},this.tween.onFinish=function(){t.onFinish&&t.onFinish()},this.tween.onReset=function(){t.onReset&&t.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var t=this.node;return this.tween.reset(),(t.getLayer()||t.getLayers()).draw(),this},seek:function(t){var e=this.node;return this.tween.seek(1e3*t),(e.getLayer()||e.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var t=this.node;return this.tween.finish(),(t.getLayer()||t.getLayers()).draw(),this},destroy:function(){var t,e=this.node._id,i=this._id,r=n.Tween.tweens[e];this.pause();for(t in r)delete n.Tween.tweens[e][t];delete n.Tween.attrs[e][i]}};var s=function(t,e,i,n,r,a,s){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=a,this._change=0,this.prevPos=0,this.yoyo=s,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=r-this.begin,this.pause()};s.prototype={fire:function(t){var e=this[t];e&&e()},setTime:function(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>t?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())},getTime:function(){return this._time},setPosition:function(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t},getPosition:function(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)},play:function(){this.state=i,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=r,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var t=this.getTimer()-this._startTime;this.state===i?this.setTime(t):this.state===r&&this.setTime(this.duration-t)},pause:function(){this.state=e,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},n.Easings={BackEaseIn:function(t,e,i,n){var r=1.70158;return i*(t/=n)*t*((r+1)*t-r)+e},BackEaseOut:function(t,e,i,n){var r=1.70158;return i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},BackEaseInOut:function(t,e,i,n){var r=1.70158;return(t/=n/2)<1?i/2*t*t*(((r*=1.525)+1)*t-r)+e:i/2*((t-=2)*t*(((r*=1.525)+1)*t+r)+2)+e},ElasticEaseIn:function(t,e,i,n,r,a){var s=0;return 0===t?e:1==(t/=n)?e+i:(a||(a=.3*n),!r||r<Math.abs(i)?(r=i,s=a/4):s=a/(2*Math.PI)*Math.asin(i/r),-(r*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*2*Math.PI/a))+e)},ElasticEaseOut:function(t,e,i,n,r,a){var s=0;return 0===t?e:1==(t/=n)?e+i:(a||(a=.3*n),!r||r<Math.abs(i)?(r=i,s=a/4):s=a/(2*Math.PI)*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*n-s)*2*Math.PI/a)+i+e)},ElasticEaseInOut:function(t,e,i,n,r,a){var s=0;return 0===t?e:2==(t/=n/2)?e+i:(a||(a=n*.3*1.5),!r||r<Math.abs(i)?(r=i,s=a/4):s=a/(2*Math.PI)*Math.asin(i/r),1>t?-.5*r*Math.pow(2,10*(t-=1))*Math.sin((t*n-s)*2*Math.PI/a)+e:.5*r*Math.pow(2,-10*(t-=1))*Math.sin((t*n-s)*2*Math.PI/a)+i+e)},BounceEaseOut:function(t,e,i,n){return(t/=n)<1/2.75?i*7.5625*t*t+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BounceEaseIn:function(t,e,i,r){return i-n.Easings.BounceEaseOut(r-t,0,i,r)+e},BounceEaseInOut:function(t,e,i,r){return r/2>t?.5*n.Easings.BounceEaseIn(2*t,0,i,r)+e:.5*n.Easings.BounceEaseOut(2*t-r,0,i,r)+.5*i+e},EaseIn:function(t,e,i,n){return i*(t/=n)*t+e},EaseOut:function(t,e,i,n){return-i*(t/=n)*(t-2)+e},EaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},StrongEaseIn:function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},StrongEaseOut:function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},StrongEaseInOut:function(t,e,i,n){return(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},Linear:function(t,e,i,n){return i*t/n+e}}}(),function(){n.DD={anim:new n.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(t){var e=n.DD,i=e.node;i&&(i._setDragPosition(t),e.isDragging||(e.isDragging=!0,i.fire("dragstart",t,!0)),i.fire("dragmove",t,!0))},_endDragBefore:function(t){var e,i,r=n.DD,a=r.node;a&&(e=a.nodeType,i=a.getLayer(),r.anim.stop(),r.isDragging&&(r.isDragging=!1,n.listenClickTap=!1,t&&(t.dragEndNode=a)),delete r.node,(i||a).draw())},_endDragAfter:function(t){t=t||{};var e=t.dragEndNode;t&&e&&e.fire("dragend",t,!0)}},n.Node.prototype.startDrag=function(){var t=n.DD,e=this.getStage(),i=this.getLayer(),r=e.getPointerPosition(),a=this.getAbsolutePosition();r&&(t.node&&t.node.stopDrag(),t.node=this,t.offset.x=r.x-a.x,t.offset.y=r.y-a.y,t.anim.setLayers(i||this.getLayers()),t.anim.start(),this._setDragPosition())},n.Node.prototype._setDragPosition=function(t){var e=n.DD,i=this.getStage().getPointerPosition(),r=this.getDragBoundFunc(),a={x:i.x-e.offset.x,y:i.y-e.offset.y};void 0!==r&&(a=r.call(this,a,t)),this.setAbsolutePosition(a)},n.Node.prototype.stopDrag=function(){var t=n.DD,e={};t._endDragBefore(e),t._endDragAfter(e)},n.Node.prototype.setDraggable=function(t){this._setAttr("draggable",t),this._dragChange()};var t=n.Node.prototype.destroy;n.Node.prototype.destroy=function(){var e=n.DD;e.node&&e.node._id===this._id&&this.stopDrag(),t.call(this)},n.Node.prototype.isDragging=function(){var t=n.DD;return t.node&&t.node._id===this._id&&t.isDragging},n.Node.prototype._listenDrag=function(){this._dragCleanup();var t=this;this.on("mousedown.kinetic touchstart.kinetic",function(e){n.DD.node||t.startDrag(e)})},n.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage(),e=n.DD;t&&e.node&&e.node._id===this._id&&e.node.stopDrag()}},n.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},n.Factory.addGetterSetter(n.Node,"dragBoundFunc"),n.Factory.addGetter(n.Node,"draggable",!1),n.Node.prototype.isDraggable=n.Node.prototype.getDraggable;var e=document.getElementsByTagName("html")[0];e.addEventListener("mouseup",n.DD._endDragBefore,!0),e.addEventListener("touchend",n.DD._endDragBefore,!0),e.addEventListener("mouseup",n.DD._endDragAfter,!1),e.addEventListener("touchend",n.DD._endDragAfter,!1)}(),function(){n.Util.addMethods(n.Container,{__init:function(t){this.children=new n.Collection,n.Node.call(this,t)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var t,e=this.children;e.length>0;)t=e[0],t.hasChildren()&&t.removeChildren(),t.remove();return this},destroyChildren:function(){for(var t=this.children;t.length>0;)t[0].destroy();return this},add:function(t){var e=this.children;return this._validateAdd(t),t.index=e.length,t.parent=this,e.push(t),this._fire("add",{child:t}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),n.Node.prototype.destroy.call(this)},get:function(t){var e,i,r,a,s,o,h,c=[],l=t.replace(/ /g,"").split(","),u=l.length;for(e=0;u>e;e++)if(r=l[e],"#"===r.charAt(0))s=this._getNodeById(r.slice(1)),s&&c.push(s);else if("."===r.charAt(0))a=this._getNodesByName(r.slice(1)),c=c.concat(a);else for(o=this.getChildren(),h=o.length,i=0;h>i;i++)c=c.concat(o[i]._get(r));return n.Collection.toCollection(c)},_getNodeById:function(t){var e=n.ids[t];return void 0!==e&&this.isAncestorOf(e)?e:null},_getNodesByName:function(t){var e=n.names[t]||[];return this._getDescendants(e)},_get:function(t){for(var e=n.Node.prototype._get.call(this,t),i=this.getChildren(),r=i.length,a=0;r>a;a++)e=e.concat(i[a]._get(t));return e},toObject:function(){var t=n.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),i=e.length,r=0;i>r;r++){var a=e[r];t.children.push(a.toObject())}return t},_getDescendants:function(t){for(var e=[],i=t.length,n=0;i>n;n++){var r=t[n];this.isAncestorOf(r)&&e.push(r)}return e},isAncestorOf:function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},clone:function(t){var e=n.Node.prototype.clone.call(this,t);return this.getChildren().each(function(t){e.add(t.clone())}),e},getAllIntersections:function(){for(var t=n.Util._getXY(Array.prototype.slice.call(arguments)),e=[],i=this.get("Shape"),r=i.length,a=0;r>a;a++){var s=i[a];s.isVisible()&&s.intersects(t)&&e.push(s)}return e},_setChildrenIndices:function(){this.children.each(function(t,e){t.index=e})},drawScene:function(t){var e=this.getLayer(),i=this.getClipWidth()&&this.getClipHeight();return!t&&e&&(t=e.getCanvas()),this.isVisible()&&(i?t.getContext()._clip(this):this._drawChildren(t)),this},_drawChildren:function(t){this.children.each(function(e){e.drawScene(t)})},drawHit:function(){var t,e=this.getClipWidth()&&this.getClipHeight()&&"Stage"!==this.nodeType,i=0,n=0,r=[];if(this.shouldDrawHit()){for(e&&(t=this.getLayer().hitCanvas,t.getContext()._clip(this)),r=this.children,n=r.length,i=0;n>i;i++)r[i].drawHit();e&&t.getContext()._context.restore()}return this}}),n.Util.extend(n.Container,n.Node),n.Factory.addBoxGetterSetter(n.Container,"clip")}(),function(){function t(t){t.fill()}function e(t){t.stroke()}function i(t){t.fill()}function r(t){t.stroke()}function a(){this._clearCache(s)}var s="hasShadow";n.Util.addMethods(n.Shape,{__init:function(s){this.nodeType="Shape",this._fillFunc=t,this._strokeFunc=e,this._fillFuncHit=i,this._strokeFuncHit=r;for(var o,h=n.shapes;;)if(o=n.Util.getRandomColor(),o&&!(o in h))break;this.colorKey=o,h[o]=this,n.Node.call(this,s),this._setDrawFuncs(),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic",a)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(s,this._hasShadow)},_hasShadow:function(){return 0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},_get:function(t){return this.className===t||this.nodeType===t?[this]:[]},intersects:function(){var t=n.Util._getXY(Array.prototype.slice.call(arguments)),e=this.getStage(),i=e.hitCanvas;i.getContext().clear(),this.drawScene(i);var r=i.context.getImageData(0|t.x,0|t.y,1,1).data;return r[3]>0},enableFill:function(){return this._setAttr("fillEnabled",!0),this},disableFill:function(){return this._setAttr("fillEnabled",!1),this},enableStroke:function(){return this._setAttr("strokeEnabled",!0),this},disableStroke:function(){return this._setAttr("strokeEnabled",!1),this},enableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!0),this},disableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!1),this},enableShadow:function(){return this._setAttr("shadowEnabled",!0),this},disableShadow:function(){return this._setAttr("shadowEnabled",!1),this},enableDashArray:function(){return this._setAttr("dashArrayEnabled",!0),this},disableDashArray:function(){return this._setAttr("dashArrayEnabled",!1),this},destroy:function(){return n.Node.prototype.destroy.call(this),delete n.shapes[this.colorKey],this},drawScene:function(t){t=t||this.getLayer().getCanvas();var e=this.getDrawFunc(),i=t.getContext();return e&&this.isVisible()&&(i.save(),i._applyOpacity(this),i._applyLineJoin(this),i._applyAncestorTransforms(this),e.call(this,i),i.restore()),this},drawHit:function(){var t=this.getAttrs(),e=t.drawHitFunc||t.drawFunc,i=this.getLayer().hitCanvas,n=i.getContext();return e&&this.shouldDrawHit()&&(n.save(),n._applyLineJoin(this),n._applyAncestorTransforms(this),e.call(this,n),n.restore()),this},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}}),n.Util.extend(n.Shape,n.Node),n.Factory.addColorGetterSetter(n.Shape,"stroke"),n.Factory.addGetterSetter(n.Shape,"lineJoin"),n.Factory.addGetterSetter(n.Shape,"lineCap"),n.Factory.addGetterSetter(n.Shape,"strokeWidth"),n.Factory.addGetterSetter(n.Shape,"drawFunc"),n.Factory.addGetterSetter(n.Shape,"drawHitFunc"),n.Factory.addGetterSetter(n.Shape,"dashArray"),n.Factory.addColorGetterSetter(n.Shape,"shadowColor"),n.Factory.addGetterSetter(n.Shape,"shadowBlur"),n.Factory.addGetterSetter(n.Shape,"shadowOpacity"),n.Factory.addGetterSetter(n.Shape,"fillPatternImage"),n.Factory.addColorGetterSetter(n.Shape,"fill"),n.Factory.addGetterSetter(n.Shape,"fillPatternX"),n.Factory.addGetterSetter(n.Shape,"fillPatternY"),n.Factory.addGetterSetter(n.Shape,"fillLinearGradientColorStops"),n.Factory.addGetterSetter(n.Shape,"fillRadialGradientStartRadius"),n.Factory.addGetterSetter(n.Shape,"fillRadialGradientEndRadius"),n.Factory.addGetterSetter(n.Shape,"fillRadialGradientColorStops"),n.Factory.addGetterSetter(n.Shape,"fillPatternRepeat"),n.Factory.addGetterSetter(n.Shape,"fillEnabled",!0),n.Factory.addGetterSetter(n.Shape,"strokeEnabled",!0),n.Factory.addGetterSetter(n.Shape,"shadowEnabled",!0),n.Factory.addGetterSetter(n.Shape,"dashArrayEnabled",!0),n.Factory.addGetterSetter(n.Shape,"fillPriority","color"),n.Factory.addGetterSetter(n.Shape,"strokeScaleEnabled",!0),n.Factory.addPointGetterSetter(n.Shape,"fillPatternOffset",0),n.Factory.addPointGetterSetter(n.Shape,"fillPatternScale",1),n.Factory.addPointGetterSetter(n.Shape,"fillLinearGradientStartPoint",0),n.Factory.addPointGetterSetter(n.Shape,"fillLinearGradientEndPoint",0),n.Factory.addPointGetterSetter(n.Shape,"fillRadialGradientStartPoint",0),n.Factory.addPointGetterSetter(n.Shape,"fillRadialGradientEndPoint",0),n.Factory.addPointGetterSetter(n.Shape,"shadowOffset",0),n.Factory.addRotationGetterSetter(n.Shape,"fillPatternRotation",0)}(),function(){function t(t,e){t.content.addEventListener(e,function(i){t[b+e](i)},!1)}var e="Stage",i="string",r="px",a="mouseout",s="mouseleave",o="mouseover",h="mouseenter",c="mousemove",l="mousedown",u="mouseup",d="click",f="dblclick",g="touchstart",p="touchend",v="tap",m="dbltap",_="touchmove",y="div",w="relative",x="inline-block",S="kineticjs-content",C=" ",b="_",P="container",T="",F=[l,c,u,a,g,_,p,o],A=F.length;n.Util.addMethods(n.Stage,{___init:function(t){n.Container.call(this,t),this.nodeType=e,this._id=n.idCounter++,this._buildDOM(),this._bindContentEvents(),n.stages.push(this)},_validateAdd:function(t){"Layer"!==t.getType()&&n.Util.error("You may only add layers to the stage.")},setContainer:function(t){return typeof t===i&&(t=document.getElementById(t)),this._setAttr(P,t),this},draw:function(){return n.Node.prototype.draw.call(this),this},setHeight:function(t){return n.Node.prototype.setHeight.call(this,t),this._resizeDOM(),this},setWidth:function(t){return n.Node.prototype.setWidth.call(this,t),this._resizeDOM(),this},clear:function(){var t,e=this.children,i=e.length;for(t=0;i>t;t++)e[t].clear();return this},destroy:function(){var t=this.content;n.Container.prototype.destroy.call(this),t&&n.Util._isInDocument(t)&&this.getContainer().removeChild(t)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(t){function e(n){var a=c[n],s=a.toDataURL(),l=new Image;l.onload=function(){h.drawImage(l,0,0),n<c.length-1?e(n+1):t.callback(o.toDataURL(i,r))},l.src=s}t=t||{};var i=t.mimeType||null,r=t.quality||null,a=t.x||0,s=t.y||0,o=new n.SceneCanvas({width:t.width||this.getWidth(),height:t.height||this.getHeight(),pixelRatio:1}),h=o.getContext()._context,c=this.children;(a||s)&&h.translate(-1*a,-1*s),e(0)},toImage:function(t){var e=t.callback;t.callback=function(t){n.Util._getImage(t,function(t){e(t)})},this.toDataURL(t)},getIntersection:function(){var t,e,i=n.Util._getXY(Array.prototype.slice.call(arguments)),r=this.getChildren(),a=r.length,s=a-1;for(t=s;t>=0;t--)if(e=r[t].getIntersection(i))return e;return null},_resizeDOM:function(){if(this.content){var t,e,i=this.getWidth(),n=this.getHeight(),a=this.getChildren(),s=a.length;for(this.content.style.width=i+r,this.content.style.height=n+r,this.bufferCanvas.setSize(i,n,1),this.hitCanvas.setSize(i,n),t=0;s>t;t++)e=a[t],e.getCanvas().setSize(i,n),e.hitCanvas.setSize(i,n),e.draw()}},add:function(t){return n.Container.prototype.add.call(this,t),t.canvas.setSize(this.attrs.width,this.attrs.height),t.hitCanvas.setSize(this.attrs.width,this.attrs.height),t.draw(),this.content.appendChild(t.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_setPointerPosition:function(t){t||(t=window.event),this._setMousePosition(t),this._setTouchPosition(t)},_bindContentEvents:function(){var e;for(e=0;A>e;e++)t(this,F[e])},_mouseover:function(t){this._fire(o,t)},_mouseout:function(t){this._setPointerPosition(t);var e=this.targetShape;e&&!n.isDragging()&&(e._fireAndBubble(a,t),e._fireAndBubble(s,t),this.targetShape=null),this.mousePos=void 0,this._fire(a,t)},_mousemove:function(t){this._setPointerPosition(t);var e,i=n.DD,r=this.getIntersection(this.getPointerPosition());r?(e=r.shape,e&&(n.isDragging()||255!==r.pixel[3]||this.targetShape&&this.targetShape._id===e._id?e._fireAndBubble(c,t):(this.targetShape&&(this.targetShape._fireAndBubble(a,t,e),this.targetShape._fireAndBubble(s,t,e)),e._fireAndBubble(o,t,this.targetShape),e._fireAndBubble(h,t,this.targetShape),this.targetShape=e))):(this._fire(c,t),this.targetShape&&!n.isDragging()&&(this.targetShape._fireAndBubble(a,t),this.targetShape._fireAndBubble(s,t),this.targetShape=null)),i&&i._drag(t),t.preventDefault&&t.preventDefault()},_mousedown:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:this;n.listenClickTap=!0,this.clickStartShape=i,i._fireAndBubble(l,t),t.preventDefault&&t.preventDefault()},_mouseup:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:this;i._fireAndBubble(u,t),n.listenClickTap&&i._id===this.clickStartShape._id&&(i._fireAndBubble(d,t),n.inDblClickWindow?(i._fireAndBubble(f,t),n.inDblClickWindow=!1):n.inDblClickWindow=!0,setTimeout(function(){n.inDblClickWindow=!1},n.dblClickWindow)),n.listenClickTap=!1,t.preventDefault&&t.preventDefault()},_touchstart:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:this;n.listenClickTap=!0,this.tapStartShape=i,i._fireAndBubble(g,t),i.isListening()&&t.preventDefault&&t.preventDefault()},_touchend:function(t){this._setPointerPosition(t);var e=this.getIntersection(this.getPointerPosition()),i=e&&e.shape?e.shape:this;i._fireAndBubble(p,t),n.listenClickTap&&i._id===this.tapStartShape._id&&(i._fireAndBubble(v,t),n.inDblClickWindow?(i._fireAndBubble(m,t),n.inDblClickWindow=!1):n.inDblClickWindow=!0,setTimeout(function(){n.inDblClickWindow=!1},n.dblClickWindow)),n.listenClickTap=!1,i.isListening()&&t.preventDefault&&t.preventDefault()},_touchmove:function(t){this._setPointerPosition(t);var e=n.DD,i=this.getIntersection(this.getPointerPosition()),r=i&&i.shape?i.shape:this;r._fireAndBubble(_,t),e&&e._drag(t),r.isListening()&&t.preventDefault&&t.preventDefault()},_setMousePosition:function(t){var e=void 0!==t.offsetX?t.offsetX:t.layerX||t.clientX-this._getContentPosition().left,i=void 0!==t.offsetY?t.offsetY:t.layerY||t.clientY-this._getContentPosition().top;this.mousePos={x:e,y:i}},_setTouchPosition:function(t){var e,i,n;void 0!==t.touches&&1===t.touches.length&&(e=t.touches[0],i=e.clientX-this._getContentPosition().left,n=e.clientY-this._getContentPosition().top,this.touchPos={x:i,y:n})},_getContentPosition:function(){var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left}},_buildDOM:function(){var t=this.getContainer();t.innerHTML=T,this.content=document.createElement(y),this.content.style.position=w,this.content.style.display=x,this.content.className=S,t.appendChild(this.content),this.bufferCanvas=new n.SceneCanvas,this.hitCanvas=new n.HitCanvas,this._resizeDOM()},_onContent:function(t,e){var i,n,r=t.split(C),a=r.length;for(i=0;a>i;i++)n=r[i],this.content.addEventListener(n,e,!1)}}),n.Util.extend(n.Stage,n.Container),n.Factory.addGetter(n.Stage,"container")}(),function(){var t="#",e="beforeDraw",i="draw";n.Util.addMethods(n.Layer,{___init:function(t){this.nodeType="Layer",this.canvas=new n.SceneCanvas,this.hitCanvas=new n.HitCanvas,n.Container.call(this,t)},_validateAdd:function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&n.Util.error("You may only add groups and shapes to a layer.")
},getIntersection:function(){var e,i,r,a=n.Util._getXY(Array.prototype.slice.call(arguments));if(this.isVisible()&&this.isListening()){if(e=this.hitCanvas.context._context.getImageData(0|a.x,0|a.y,1,1).data,255===e[3])return i=n.Util._rgbToHex(e[0],e[1],e[2]),r=n.shapes[t+i],{shape:r,pixel:e};if(e[0]>0||e[1]>0||e[2]>0||e[3]>0)return{pixel:e}}return null},drawScene:function(t){return t=t||this.getCanvas(),this._fire(e,{node:this}),this.getClearBeforeDraw()&&t.getContext().clear(),n.Container.prototype.drawScene.call(this,t),this._fire(i,{node:this}),this},drawHit:function(){var t=this.getLayer();return t&&t.getClearBeforeDraw()&&t.getHitCanvas().getContext().clear(),n.Container.prototype.drawHit.call(this),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(t){return this.getCanvas().clear(t),this},setVisible:function(t){return n.Node.prototype.setVisible.call(this,t),t?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(t){n.Node.prototype.setZIndex.call(this,t);var e=this.getStage();return e&&(e.content.removeChild(this.getCanvas()._canvas),t<e.getChildren().length-1?e.content.insertBefore(this.getCanvas()._canvas,e.getChildren()[t+1].getCanvas()._canvas):e.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){n.Node.prototype.moveToTop.call(this);var t=this.getStage();t&&(t.content.removeChild(this.getCanvas()._canvas),t.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(n.Node.prototype.moveUp.call(this)){var t=this.getStage();t&&(t.content.removeChild(this.getCanvas()._canvas),this.index<t.getChildren().length-1?t.content.insertBefore(this.getCanvas()._canvas,t.getChildren()[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(n.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(n.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.getCanvas()._canvas),t.content.insertBefore(this.getCanvas()._canvas,e[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var t=this.getStage(),e=this.getCanvas(),i=e._canvas;return n.Node.prototype.remove.call(this),t&&i&&n.Util._isInDocument(i)&&t.content.removeChild(i),this},getStage:function(){return this.parent}}),n.Util.extend(n.Layer,n.Container),n.Factory.addGetterSetter(n.Layer,"clearBeforeDraw",!0)}(),function(){n.Util.addMethods(n.Group,{___init:function(t){this.nodeType="Group",n.Container.call(this,t)},_validateAdd:function(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&n.Util.error("You may only add groups and shapes to groups.")}}),n.Util.extend(n.Group,n.Container)}(),function(){n.Rect=function(t){this.___init(t)},n.Rect.prototype={___init:function(t){n.Shape.call(this,t),this.className="Rect"},drawFunc:function(t){var e=this.getCornerRadius(),i=this.getWidth(),n=this.getHeight();t.beginPath(),e?(t.moveTo(e,0),t.lineTo(i-e,0),t.arc(i-e,e,e,3*Math.PI/2,0,!1),t.lineTo(i,n-e),t.arc(i-e,n-e,e,0,Math.PI/2,!1),t.lineTo(e,n),t.arc(e,n-e,e,Math.PI/2,Math.PI,!1),t.lineTo(0,e),t.arc(e,e,e,Math.PI,3*Math.PI/2,!1)):t.rect(0,0,i,n),t.closePath(),t.fillStrokeShape(this)}},n.Util.extend(n.Rect,n.Shape),n.Factory.addGetterSetter(n.Rect,"cornerRadius",0)}(),function(){var t=2*Math.PI-1e-4,e="Circle";n.Circle=function(t){this.___init(t)},n.Circle.prototype={___init:function(t){n.Shape.call(this,t),this.className=e},drawFunc:function(e){e.beginPath(),e.arc(0,0,this.getRadius(),0,t,!1),e.closePath(),e.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(t){n.Node.prototype.setWidth.call(this,t),this.setRadius(t/2)},setHeight:function(t){n.Node.prototype.setHeight.call(this,t),this.setRadius(t/2)}},n.Util.extend(n.Circle,n.Shape),n.Factory.addGetterSetter(n.Circle,"radius",0)}(),function(){var t=2*Math.PI-1e-4,e="Ellipse";n.Ellipse=function(t){this.___init(t)},n.Ellipse.prototype={___init:function(t){n.Shape.call(this,t),this.className=e},drawFunc:function(e){var i=this.getRadius();e.beginPath(),e.save(),i.x!==i.y&&e.scale(1,i.y/i.x),e.arc(0,0,i.x,0,t,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius().x},getHeight:function(){return 2*this.getRadius().y},setWidth:function(t){n.Node.prototype.setWidth.call(this,t),this.setRadius({x:t/2})},setHeight:function(t){n.Node.prototype.setHeight.call(this,t),this.setRadius({y:t/2})}},n.Util.extend(n.Ellipse,n.Shape),n.Factory.addPointGetterSetter(n.Ellipse,"radius",0)}(),function(){n.Wedge=function(t){this.___init(t)},n.Wedge.prototype={___init:function(t){n.Shape.call(this,t),this.className="Wedge"},drawFunc:function(t){t.beginPath(),t.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}},n.Util.extend(n.Wedge,n.Shape),n.Factory.addGetterSetter(n.Wedge,"radius",0),n.Factory.addRotationGetterSetter(n.Wedge,"angle",0),n.Factory.addGetterSetter(n.Wedge,"clockwise",!1)}(),function(){var t="Image",e="set";n.Image=function(t){this.___init(t)},n.Image.prototype={___init:function(e){n.Shape.call(this,e),this.className=t},drawFunc:function(t){var e,i,n=this.getWidth(),r=this.getHeight(),a=this.getCropX()||0,s=this.getCropY()||0,o=this.getCropWidth(),h=this.getCropHeight();this.getFilter()&&this._applyFilter&&(this.applyFilter(),this._applyFilter=!1),i=this.filterCanvas?this.filterCanvas._canvas:this.getImage(),t.beginPath(),t.rect(0,0,n,r),t.closePath(),t.fillStrokeShape(this),i&&(e=o&&h?[i,a,s,o,h,0,0,n,r]:[i,0,0,n,r],this.hasShadow()?t.applyShadow(this,function(){t.drawImage.apply(t,e)}):t.drawImage.apply(t,e))},drawHitFunc:function(t){var e=this.getWidth(),i=this.getHeight(),n=this.imageHitRegion;n?(t.drawImage(n,0,0,e,i),t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.strokeShape(this)):(t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this))},applyFilter:function(){var t,e,i,r=this.getImage(),a=this.getWidth(),s=this.getHeight(),o=this.getFilter();this.filterCanvas?(t=this.filterCanvas,t.getContext().clear()):t=this.filterCanvas=new n.SceneCanvas({width:a,height:s,pixelRatio:1}),e=t.getContext();try{e.drawImage(r,0,0,t.getWidth(),t.getHeight()),i=e.getImageData(0,0,t.getWidth(),t.getHeight()),o.call(this,i),e.putImageData(i,0,0)}catch(h){this.clearFilter(),n.Util.warn("Unable to apply filter. "+h.message)}},clearFilter:function(){this.filterCanvas=null,this._applyFilter=!1},createImageHitRegion:function(t){var e,i,r,a,s,o=this,h=this.getWidth(),c=this.getHeight(),l=new n.SceneCanvas({width:h,height:c}),u=l.getContext()._context,d=this.getImage();u.drawImage(d,0,0);try{for(e=u.getImageData(0,0,h,c),i=e.data,s=i.length,r=n.Util._hexToRgb(this.colorKey),a=0;s>a;a+=4)i[a+3]>0&&(i[a]=r.r,i[a+1]=r.g,i[a+2]=r.b);n.Util._getImage(e,function(e){o.imageHitRegion=e,t&&t()})}catch(f){n.Util.warn("Unable to create image hit region. "+f.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var t=this.getImage();return this.attrs.width||(t?t.width:0)},getHeight:function(){var t=this.getImage();return this.attrs.height||(t?t.height:0)}},n.Util.extend(n.Image,n.Shape),n.Factory.addFilterGetterSetter=function(t,e,i){this.addGetter(t,e,i),this.addFilterSetter(t,e)},n.Factory.addFilterSetter=function(t,i){var r=e+n.Util._capitalize(i);t.prototype[r]=function(t){this._setAttr(i,t),this._applyFilter=!0}},n.Factory.addGetterSetter(n.Image,"image"),n.Factory.addBoxGetterSetter(n.Image,"crop"),n.Factory.addFilterGetterSetter(n.Image,"filter")}(),function(){n.Polygon=function(t){this.___init(t)},n.Polygon.prototype={___init:function(t){n.Shape.call(this,t),this.className="Polygon"},drawFunc:function(t){var e=this.getPoints(),i=e.length;t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;i>n;n++)t.lineTo(e[n].x,e[n].y);t.closePath(),t.fillStrokeShape(this)}},n.Util.extend(n.Polygon,n.Shape),n.Factory.addPointsGetterSetter(n.Polygon,"points")}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var i="auto",r="Calibri",a="canvas",s="center",o="Change.kinetic",h="2d",c="-",l="",u="left",d="text",f="Text",g="middle",p="normal",v="px ",m=" ",_="right",y="word",w="char",x="none",S=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],C=S.length,b=document.createElement(a).getContext(h);n.Text=function(t){this.___init(t)},n.Text.prototype={___init:function(r){var a=this;void 0===r.width&&(r.width=i),void 0===r.height&&(r.height=i),n.Shape.call(this,r),this._fillFunc=t,this._strokeFunc=e,this.className=f;for(var s=0;C>s;s++)this.on(S[s]+o,a._setTextData);this._setTextData()},drawFunc:function(t){var e=this.getPadding(),i=(this.getFontStyle(),this.getFontSize(),this.getFontFamily(),this.getTextHeight()),n=this.getLineHeight()*i,r=this.textArr,a=r.length,o=this.getWidth();t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",g),t.setAttr("textAlign",u),t.save(),t.translate(e,0),t.translate(0,e+i/2);for(var h=0;a>h;h++){var c=r[h],l=c.text,d=c.width;t.save(),this.getAlign()===_?t.translate(o-d-2*e,0):this.getAlign()===s&&t.translate((o-d-2*e)/2,0),this.partialText=l,t.fillStrokeShape(this),t.restore(),t.translate(0,n)}t.restore()},drawHitFunc:function(t){var e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)},setText:function(t){var e=n.Util._isString(t)?t:t.toString();this._setAttr(d,e)},getWidth:function(){return this.attrs.width===i?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===i?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(t){var e,i=b,n=this.getFontSize();return i.save(),i.font=this._getContextFont(),e=i.measureText(t),i.restore(),{width:e.width,height:parseInt(n,10)}},_getContextFont:function(){return this.getFontStyle()+m+this.getFontSize()+v+this.getFontFamily()},_addTextLine:function(t,e){return this.textArr.push({text:t,width:e})},_getTextWidth:function(t){return b.measureText(t).width},_setTextData:function(){var t=this.getText().split("\n"),e=+this.getFontSize(),n=0,r=this.getLineHeight()*e,a=this.attrs.width,s=this.attrs.height,o=a!==i,h=s!==i,l=this.getPadding(),u=a-2*l,d=s-2*l,f=0,g=this.getWrap(),p=g!==x,_=g!==w&&p;this.textArr=[],b.save(),b.font=this.getFontStyle()+m+e+v+this.getFontFamily();for(var y=0,S=t.length;S>y;++y){var C=t[y],P=this._getTextWidth(C);if(o&&P>u)for(;C.length>0;){for(var T=0,F=C.length,A="",k=0;F>T;){var D=T+F>>>1,L=C.slice(0,D+1),I=this._getTextWidth(L);u>=I?(T=D+1,A=L,k=I):F=D}if(!A)break;if(_){var R=Math.max(A.lastIndexOf(m),A.lastIndexOf(c))+1;R>0&&(T=R,A=A.slice(0,T),k=this._getTextWidth(A))}if(this._addTextLine(A,k),f+=r,!p||h&&f+r>d)break;if(C=C.slice(T),C.length>0&&(P=this._getTextWidth(C),u>=P)){this._addTextLine(C,P),f+=r;break}}else this._addTextLine(C,P),f+=r,n=Math.max(n,P);if(h&&f+r>d)break}b.restore(),this.textHeight=e,this.textWidth=n}},n.Util.extend(n.Text,n.Shape),n.Factory.addGetterSetter(n.Text,"fontFamily",r),n.Factory.addGetterSetter(n.Text,"fontSize",12),n.Factory.addGetterSetter(n.Text,"fontStyle",p),n.Factory.addGetterSetter(n.Text,"padding",0),n.Factory.addGetterSetter(n.Text,"align",u),n.Factory.addGetterSetter(n.Text,"lineHeight",1),n.Factory.addGetterSetter(n.Text,"wrap",y),n.Factory.addGetter(n.Text,d,l),n.Factory.addSetter(n.Text,"width"),n.Factory.addSetter(n.Text,"height")}(),function(){n.Line=function(t){this.___init(t)},n.Line.prototype={___init:function(t){n.Shape.call(this,t),this.className="Line"},drawFunc:function(t){var e,i,n=this.getPoints(),r=n.length;for(t.beginPath(),t.moveTo(n[0].x,n[0].y),e=1;r>e;e++)i=n[e],t.lineTo(i.x,i.y);t.strokeShape(this)}},n.Util.extend(n.Line,n.Shape),n.Factory.addPointsGetterSetter(n.Line,"points")}(),function(){n.Spline=function(t){this.___init(t)},n.Spline.prototype={___init:function(t){var e=this;n.Shape.call(this,t),this.className="Spline",this.on("pointsChange.kinetic tensionChange.kinetic",function(){e._setAllPoints()}),this._setAllPoints()},drawFunc:function(t){var e,i,n,r,a=this.getPoints(),s=a.length,o=this.getTension();if(t.beginPath(),t.moveTo(a[0].x,a[0].y),0!==o&&s>2){for(e=this.allPoints,i=e.length,n=2,t.quadraticCurveTo(e[0].x,e[0].y,e[1].x,e[1].y);i-1>n;)t.bezierCurveTo(e[n].x,e[n++].y,e[n].x,e[n++].y,e[n].x,e[n++].y);t.quadraticCurveTo(e[i-1].x,e[i-1].y,a[s-1].x,a[s-1].y)}else for(n=1;s>n;n++)r=a[n],t.lineTo(r.x,r.y);t.strokeShape(this)},_setAllPoints:function(){this.allPoints=n.Util._expandPoints(this.getPoints(),this.getTension())}},n.Util.extend(n.Spline,n.Shape),n.Factory.addGetterSetter(n.Spline,"tension",1),n.Factory.addPointsGetterSetter(n.Spline,"points")}(),function(){n.Blob=function(t){this.___init(t)},n.Blob.prototype={___init:function(t){var e=this;n.Shape.call(this,t),this.className="Blob",this.on("pointsChange.kinetic tensionChange.kinetic",function(){e._setAllPoints()}),this._setAllPoints()},drawFunc:function(t){var e,i,n,r,a=this.getPoints(),s=a.length,o=this.getTension();if(t.beginPath(),t.moveTo(a[0].x,a[0].y),0!==o&&s>2)for(e=this.allPoints,i=e.length,n=0;i-1>n;)t.bezierCurveTo(e[n].x,e[n++].y,e[n].x,e[n++].y,e[n].x,e[n++].y);else for(n=1;s>n;n++)r=a[n],t.lineTo(r.x,r.y);t.closePath(),t.fillStrokeShape(this)},_setAllPoints:function(){var t=this.getPoints(),e=t.length,i=this.getTension(),r=n.Util,a=r._getControlPoints(t[e-1],t[0],t[1],i),s=r._getControlPoints(t[e-2],t[e-1],t[0],i);this.allPoints=n.Util._expandPoints(this.getPoints(),this.getTension()),this.allPoints.unshift(a[1]),this.allPoints.push(s[0]),this.allPoints.push(t[e-1]),this.allPoints.push(s[1]),this.allPoints.push(a[0]),this.allPoints.push(t[0])}},n.Util.extend(n.Blob,n.Shape),n.Factory.addGetterSetter(n.Blob,"tension",1),n.Factory.addPointsGetterSetter(n.Blob,"points")}(),function(){n.Sprite=function(t){this.___init(t)},n.Sprite.prototype={___init:function(t){n.Shape.call(this,t),this.className="Sprite",this.anim=new n.Animation;var e=this;this.on("animationChange.kinetic",function(){e.setIndex(0)})},drawFunc:function(t){var e=this.getAnimation(),i=this.getIndex(),n=this.getAnimations()[e][i],r=this.getImage();r&&t.drawImage(r,n.x,n.y,n.width,n.height,0,0,n.width,n.height)},drawHitFunc:function(t){var e=this.getAnimation(),i=this.getIndex(),n=this.getAnimations()[e][i];t.beginPath(),t.rect(0,0,n.width,n.height),t.closePath(),t.fill(this)},start:function(){var t=this,e=this.getLayer();this.anim.setLayers(e),this.interval=setInterval(function(){var e=t.getIndex();t._updateIndex(),t.afterFrameFunc&&e===t.afterFrameIndex&&(t.afterFrameFunc(),delete t.afterFrameFunc,delete t.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(t,e){this.afterFrameIndex=t,this.afterFrameFunc=e},_updateIndex:function(){var t=this.getIndex(),e=this.getAnimation(),i=this.getAnimations(),n=i[e],r=n.length;r-1>t?this.setIndex(t+1):this.setIndex(0)}},n.Util.extend(n.Sprite,n.Shape),n.Factory.addGetterSetter(n.Sprite,"animation"),n.Factory.addGetterSetter(n.Sprite,"animations"),n.Factory.addGetterSetter(n.Sprite,"image"),n.Factory.addGetterSetter(n.Sprite,"index",0),n.Factory.addGetterSetter(n.Sprite,"frameRate",17)}(),function(){n.Path=function(t){this.___init(t)},n.Path.prototype={___init:function(t){this.dataArray=[];var e=this;n.Shape.call(this,t),this.className="Path",this.dataArray=n.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){e.dataArray=n.Path.parsePathData(this.getData())})},drawFunc:function(t){var e=this.dataArray,i=!1;t.beginPath();for(var n=0;n<e.length;n++){var r=e[n].command,a=e[n].points;switch(r){case"L":t.lineTo(a[0],a[1]);break;case"M":t.moveTo(a[0],a[1]);break;case"C":t.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case"Q":t.quadraticCurveTo(a[0],a[1],a[2],a[3]);break;case"A":var s=a[0],o=a[1],h=a[2],c=a[3],l=a[4],u=a[5],d=a[6],f=a[7],g=h>c?h:c,p=h>c?1:h/c,v=h>c?c/h:1;t.translate(s,o),t.rotate(d),t.scale(p,v),t.arc(0,0,g,l,l+u,1-f),t.scale(1/p,1/v),t.rotate(-d),t.translate(-s,-o);break;case"z":t.closePath(),i=!0}}i?t.fillStrokeShape(this):t.strokeShape(this)}},n.Util.extend(n.Path,n.Shape),n.Path.getLineLength=function(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))},n.Path.getPointOnLine=function(t,e,i,n,r,a,s){void 0===a&&(a=e),void 0===s&&(s=i);var o=(r-i)/(n-e+1e-8),h=Math.sqrt(t*t/(1+o*o));e>n&&(h*=-1);var c,l=o*h;if(n===e)c={x:a,y:s+l};else if((s-i)/(a-e+1e-8)===o)c={x:a+h,y:s+l};else{var u,d,f=this.getLineLength(e,i,n,r);if(1e-8>f)return void 0;var g=(a-e)*(n-e)+(s-i)*(r-i);g/=f*f,u=e+g*(n-e),d=i+g*(r-i);var p=this.getLineLength(a,s,u,d),v=Math.sqrt(t*t-p*p);h=Math.sqrt(v*v/(1+o*o)),e>n&&(h*=-1),l=o*h,c={x:u+h,y:d+l}}return c},n.Path.getPointOnCubicBezier=function(t,e,i,n,r,a,s,o,h){function c(t){return t*t*t}function l(t){return 3*t*t*(1-t)}function u(t){return 3*t*(1-t)*(1-t)}function d(t){return(1-t)*(1-t)*(1-t)}var f=o*c(t)+a*l(t)+n*u(t)+e*d(t),g=h*c(t)+s*l(t)+r*u(t)+i*d(t);return{x:f,y:g}},n.Path.getPointOnQuadraticBezier=function(t,e,i,n,r,a,s){function o(t){return t*t}function h(t){return 2*t*(1-t)}function c(t){return(1-t)*(1-t)}var l=a*o(t)+n*h(t)+e*c(t),u=s*o(t)+r*h(t)+i*c(t);return{x:l,y:u}},n.Path.getPointOnEllipticalArc=function(t,e,i,n,r,a){var s=Math.cos(a),o=Math.sin(a),h={x:i*Math.cos(r),y:n*Math.sin(r)};return{x:t+(h.x*s-h.y*o),y:e+(h.x*o+h.y*s)}},n.Path.parsePathData=function(t){if(!t)return[];var e=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var n=0;n<i.length;n++)e=e.replace(new RegExp(i[n],"g"),"|"+i[n]);var r=e.split("|"),a=[],s=0,o=0;for(n=1;n<r.length;n++){var h=r[n],c=h.charAt(0);h=h.slice(1),h=h.replace(new RegExp(",-","g"),"-"),h=h.replace(new RegExp("-","g"),",-"),h=h.replace(new RegExp("e,-","g"),"e-");var l=h.split(",");l.length>0&&""===l[0]&&l.shift();for(var u=0;u<l.length;u++)l[u]=parseFloat(l[u]);for(;l.length>0&&!isNaN(l[0]);){var d,f,g,p,v,m,_,y,w,x,S=null,C=[],b=s,P=o;switch(c){case"l":s+=l.shift(),o+=l.shift(),S="L",C.push(s,o);break;case"L":s=l.shift(),o=l.shift(),C.push(s,o);break;case"m":s+=l.shift(),o+=l.shift(),S="M",C.push(s,o),c="l";break;case"M":s=l.shift(),o=l.shift(),S="M",C.push(s,o),c="L";break;case"h":s+=l.shift(),S="L",C.push(s,o);break;case"H":s=l.shift(),S="L",C.push(s,o);break;case"v":o+=l.shift(),S="L",C.push(s,o);break;case"V":o=l.shift(),S="L",C.push(s,o);break;case"C":C.push(l.shift(),l.shift(),l.shift(),l.shift()),s=l.shift(),o=l.shift(),C.push(s,o);break;case"c":C.push(s+l.shift(),o+l.shift(),s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),S="C",C.push(s,o);break;case"S":f=s,g=o,d=a[a.length-1],"C"===d.command&&(f=s+(s-d.points[2]),g=o+(o-d.points[3])),C.push(f,g,l.shift(),l.shift()),s=l.shift(),o=l.shift(),S="C",C.push(s,o);break;case"s":f=s,g=o,d=a[a.length-1],"C"===d.command&&(f=s+(s-d.points[2]),g=o+(o-d.points[3])),C.push(f,g,s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),S="C",C.push(s,o);break;case"Q":C.push(l.shift(),l.shift()),s=l.shift(),o=l.shift(),C.push(s,o);break;case"q":C.push(s+l.shift(),o+l.shift()),s+=l.shift(),o+=l.shift(),S="Q",C.push(s,o);break;case"T":f=s,g=o,d=a[a.length-1],"Q"===d.command&&(f=s+(s-d.points[0]),g=o+(o-d.points[1])),s=l.shift(),o=l.shift(),S="Q",C.push(f,g,s,o);break;case"t":f=s,g=o,d=a[a.length-1],"Q"===d.command&&(f=s+(s-d.points[0]),g=o+(o-d.points[1])),s+=l.shift(),o+=l.shift(),S="Q",C.push(f,g,s,o);break;case"A":p=l.shift(),v=l.shift(),m=l.shift(),_=l.shift(),y=l.shift(),w=s,x=o,s=l.shift(),o=l.shift(),S="A",C=this.convertEndpointToCenterParameterization(w,x,s,o,_,y,p,v,m);break;case"a":p=l.shift(),v=l.shift(),m=l.shift(),_=l.shift(),y=l.shift(),w=s,x=o,s+=l.shift(),o+=l.shift(),S="A",C=this.convertEndpointToCenterParameterization(w,x,s,o,_,y,p,v,m)}a.push({command:S||c,points:C,start:{x:b,y:P},pathLength:this.calcLength(b,P,S||c,C)})}("z"===c||"Z"===c)&&a.push({command:"z",points:[],start:void 0,pathLength:0})}return a},n.Path.calcLength=function(e,i,r,a){var s,o,h,c=n.Path;switch(r){case"L":return c.getLineLength(e,i,a[0],a[1]);case"C":for(s=0,o=c.getPointOnCubicBezier(0,e,i,a[0],a[1],a[2],a[3],a[4],a[5]),t=.01;1>=t;t+=.01)h=c.getPointOnCubicBezier(t,e,i,a[0],a[1],a[2],a[3],a[4],a[5]),s+=c.getLineLength(o.x,o.y,h.x,h.y),o=h;return s;case"Q":for(s=0,o=c.getPointOnQuadraticBezier(0,e,i,a[0],a[1],a[2],a[3]),t=.01;1>=t;t+=.01)h=c.getPointOnQuadraticBezier(t,e,i,a[0],a[1],a[2],a[3]),s+=c.getLineLength(o.x,o.y,h.x,h.y),o=h;return s;case"A":s=0;var l=a[4],u=a[5],d=a[4]+u,f=Math.PI/180;if(Math.abs(l-d)<f&&(f=Math.abs(l-d)),o=c.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],l,0),0>u)for(t=l-f;t>d;t-=f)h=c.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],t,0),s+=c.getLineLength(o.x,o.y,h.x,h.y),o=h;else for(t=l+f;d>t;t+=f)h=c.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],t,0),s+=c.getLineLength(o.x,o.y,h.x,h.y),o=h;return h=c.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],d,0),s+=c.getLineLength(o.x,o.y,h.x,h.y)}return 0},n.Path.convertEndpointToCenterParameterization=function(t,e,i,n,r,a,s,o,h){var c=h*(Math.PI/180),l=Math.cos(c)*(t-i)/2+Math.sin(c)*(e-n)/2,u=-1*Math.sin(c)*(t-i)/2+Math.cos(c)*(e-n)/2,d=l*l/(s*s)+u*u/(o*o);d>1&&(s*=Math.sqrt(d),o*=Math.sqrt(d));var f=Math.sqrt((s*s*o*o-s*s*u*u-o*o*l*l)/(s*s*u*u+o*o*l*l));r==a&&(f*=-1),isNaN(f)&&(f=0);var g=f*s*u/o,p=f*-o*l/s,v=(t+i)/2+Math.cos(c)*g-Math.sin(c)*p,m=(e+n)/2+Math.sin(c)*g+Math.cos(c)*p,_=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},y=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(_(t)*_(e))},w=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(y(t,e))},x=w([1,0],[(l-g)/s,(u-p)/o]),S=[(l-g)/s,(u-p)/o],C=[(-1*l-g)/s,(-1*u-p)/o],b=w(S,C);return y(S,C)<=-1&&(b=Math.PI),y(S,C)>=1&&(b=0),0===a&&b>0&&(b-=2*Math.PI),1==a&&0>b&&(b+=2*Math.PI),[v,m,s,o,x,b,c,a]},n.Factory.addGetterSetter(n.Path,"data")}(),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var i="",r="Calibri",a="normal";n.TextPath=function(t){this.___init(t)},n.TextPath.prototype={___init:function(i){var r=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],n.Shape.call(this,i),this._fillFunc=t,this._strokeFunc=e,this.className="TextPath",this.dataArray=n.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){r.dataArray=n.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",r._setTextData),r._setTextData()},drawFunc:function(t){this.charArr,t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline","middle"),t.setAttr("textAlign","left"),t.save();for(var e=this.glyphInfo,i=0;i<e.length;i++){t.save();var n=e[i].p0;e[i].p1,parseFloat(this.attrs.fontSize),t.translate(n.x,n.y),t.rotate(e[i].rotation),this.partialText=e[i].text,t.fillStrokeShape(this),t.restore()}},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(t){n.Text.prototype.setText.call(this,t)},_getTextSize:function(t){var e=this.dummyCanvas,i=e.getContext("2d");i.save(),i.font=this._getContextFont();var n=i.measureText(t);return i.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var t=this,e=this._getTextSize(this.attrs.text);this.textWidth=e.width,this.textHeight=e.height,this.glyphInfo=[];for(var i,r,a,s=this.attrs.text.split(""),o=-1,h=0,c=function(){h=0;for(var e=t.dataArray,n=o+1;n<e.length;n++){if(e[n].pathLength>0)return o=n,e[n];"M"==e[n].command&&(i={x:e[n].points[0],y:e[n].points[1]})}return{}},l=function(e){var s=t._getTextSize(e).width,o=0,l=0;for(r=void 0;Math.abs(s-o)/s>.01&&25>l;){l++;for(var u=o;void 0===a;)a=c(),a&&u+a.pathLength<s&&(u+=a.pathLength,a=void 0);if(a==={}||void 0===i)return void 0;var d=!1;switch(a.command){case"L":n.Path.getLineLength(i.x,i.y,a.points[0],a.points[1])>s?r=n.Path.getPointOnLine(s,i.x,i.y,a.points[0],a.points[1],i.x,i.y):a=void 0;break;case"A":var f=a.points[4],g=a.points[5],p=a.points[4]+g;0===h?h=f+1e-8:s>o?h+=Math.PI/180*g/Math.abs(g):h-=Math.PI/360*g/Math.abs(g),(0>g&&p>h||g>=0&&h>p)&&(h=p,d=!0),r=n.Path.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],h,a.points[6]);break;case"C":0===h?h=s>a.pathLength?1e-8:s/a.pathLength:s>o?h+=(s-o)/a.pathLength:h-=(o-s)/a.pathLength,h>1&&(h=1,d=!0),r=n.Path.getPointOnCubicBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case"Q":0===h?h=s/a.pathLength:s>o?h+=(s-o)/a.pathLength:h-=(o-s)/a.pathLength,h>1&&(h=1,d=!0),r=n.Path.getPointOnQuadraticBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3])}void 0!==r&&(o=n.Path.getLineLength(i.x,i.y,r.x,r.y)),d&&(d=!1,a=void 0)}},u=0;u<s.length&&(l(s[u]),void 0!==i&&void 0!==r);u++){var d=n.Path.getLineLength(i.x,i.y,r.x,r.y),f=0,g=n.Path.getPointOnLine(f+d/2,i.x,i.y,r.x,r.y),p=Math.atan2(r.y-i.y,r.x-i.x);this.glyphInfo.push({transposeX:g.x,transposeY:g.y,text:s[u],rotation:p,p0:i,p1:r}),i=r}}},n.TextPath.prototype._getContextFont=n.Text.prototype._getContextFont,n.Util.extend(n.TextPath,n.Shape),n.Factory.addGetterSetter(n.TextPath,"fontFamily",r),n.Factory.addGetterSetter(n.TextPath,"fontSize",12),n.Factory.addGetterSetter(n.TextPath,"fontStyle",a),n.Factory.addGetter(n.TextPath,"text",i)}(),function(){n.RegularPolygon=function(t){this.___init(t)},n.RegularPolygon.prototype={___init:function(t){n.Shape.call(this,t),this.className="RegularPolygon"},drawFunc:function(t){var e,i,n,r=this.attrs.sides,a=this.attrs.radius;for(t.beginPath(),t.moveTo(0,0-a),e=1;r>e;e++)i=a*Math.sin(2*e*Math.PI/r),n=-1*a*Math.cos(2*e*Math.PI/r),t.lineTo(i,n);t.closePath(),t.fillStrokeShape(this)}},n.Util.extend(n.RegularPolygon,n.Shape),n.Factory.addGetterSetter(n.RegularPolygon,"radius",0),n.Factory.addGetterSetter(n.RegularPolygon,"sides",0)}(),function(){n.Star=function(t){this.___init(t)},n.Star.prototype={___init:function(t){n.Shape.call(this,t),this.className="Star"},drawFunc:function(t){var e=t._context,i=this.attrs.innerRadius,n=this.attrs.outerRadius,r=this.attrs.numPoints;e.beginPath(),e.moveTo(0,0-this.attrs.outerRadius);for(var a=1;2*r>a;a++){var s=0===a%2?n:i,o=s*Math.sin(a*Math.PI/r),h=-1*s*Math.cos(a*Math.PI/r);e.lineTo(o,h)}e.closePath(),t.fillStrokeShape(this)}},n.Util.extend(n.Star,n.Shape),n.Factory.addGetterSetter(n.Star,"numPoints",0),n.Factory.addGetterSetter(n.Star,"innerRadius",0),n.Factory.addGetterSetter(n.Star,"outerRadius",0)}(),function(){var t=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],e="Change.kinetic",i="none",r="up",a="right",s="down",o="left",h="Label",c=t.length;n.Label=function(t){this.____init(t)},n.Label.prototype={____init:function(t){var e=this;this.className=h,n.Group.call(this,t),this.on("add.kinetic",function(t){e._addListeners(t.child),e._sync()})},getText:function(){return this.get("Text")[0]},getTag:function(){return this.get("Tag")[0]},_addListeners:function(i){var n,r=this,a=function(){r._sync()};for(n=0;c>n;n++)i.on(t[n]+e,a)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var t,e,i,n,h,c,l=this.getText(),u=this.getTag();if(l&&u){switch(t=l.getWidth(),e=l.getHeight(),i=u.getPointerDirection(),n=u.getPointerWidth(),pointerHeight=u.getPointerHeight(),h=0,c=0,i){case r:h=t/2,c=-1*pointerHeight;break;case a:h=t+n,c=e/2;break;case s:h=t/2,c=e+pointerHeight;break;case o:h=-1*n,c=e/2}u.setAttrs({x:-1*h,y:-1*c,width:t,height:e}),l.setAttrs({x:-1*h,y:-1*c})}}},n.Util.extend(n.Label,n.Group),n.Tag=function(t){this.___init(t)},n.Tag.prototype={___init:function(t){n.Shape.call(this,t),this.className="Tag"},drawFunc:function(t){var e=this.getWidth(),i=this.getHeight(),n=this.getPointerDirection(),h=this.getPointerWidth(),c=this.getPointerHeight();this.getCornerRadius(),t.beginPath(),t.moveTo(0,0),n===r&&(t.lineTo((e-h)/2,0),t.lineTo(e/2,-1*c),t.lineTo((e+h)/2,0)),t.lineTo(e,0),n===a&&(t.lineTo(e,(i-c)/2),t.lineTo(e+h,i/2),t.lineTo(e,(i+c)/2)),t.lineTo(e,i),n===s&&(t.lineTo((e+h)/2,i),t.lineTo(e/2,i+c),t.lineTo((e-h)/2,i)),t.lineTo(0,i),n===o&&(t.lineTo(0,(i+c)/2),t.lineTo(-1*h,i/2),t.lineTo(0,(i-c)/2)),t.closePath(),t.fillStrokeShape(this)}},n.Util.extend(n.Tag,n.Shape),n.Factory.addGetterSetter(n.Tag,"pointerDirection",i),n.Factory.addGetterSetter(n.Tag,"pointerWidth",0),n.Factory.addGetterSetter(n.Tag,"pointerHeight",0),n.Factory.addGetterSetter(n.Tag,"cornerRadius",0)}(),function(){n.Filters.Grayscale=function(t){for(var e=t.data,i=0;i<e.length;i+=4){var n=.34*e[i]+.5*e[i+1]+.16*e[i+2];e[i]=n,e[i+1]=n,e[i+2]=n}}}(),function(){n.Filters.Brighten=function(t){for(var e=this.getFilterBrightness(),i=t.data,n=0;n<i.length;n+=4)i[n]+=e,i[n+1]+=e,i[n+2]+=e},n.Factory.addFilterGetterSetter(n.Image,"filterBrightness",0)}(),function(){n.Filters.Invert=function(t){for(var e=t.data,i=0;i<e.length;i+=4)e[i]=255-e[i],e[i+1]=255-e[i+1],e[i+2]=255-e[i+2]}}(),function(){function t(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function e(e,n){var a,s,o,h,c,l,u,d,f,g,p,v,m,_,y,w,x,S,C,b,P,T,F,A,k=e.data,D=e.width,L=e.height,I=n+n+1,R=D-1,G=L-1,M=n+1,N=M*(M+1)/2,U=new t,E=null,O=U,B=null,H=null,z=i[n],W=r[n];for(o=1;I>o;o++)O=O.next=new t,o==M&&(E=O);for(O.next=U,u=l=0,s=0;L>s;s++){for(w=x=S=C=d=f=g=p=0,v=M*(b=k[l]),m=M*(P=k[l+1]),_=M*(T=k[l+2]),y=M*(F=k[l+3]),d+=N*b,f+=N*P,g+=N*T,p+=N*F,O=U,o=0;M>o;o++)O.r=b,O.g=P,O.b=T,O.a=F,O=O.next;for(o=1;M>o;o++)h=l+((o>R?R:o)<<2),d+=(O.r=b=k[h])*(A=M-o),f+=(O.g=P=k[h+1])*A,g+=(O.b=T=k[h+2])*A,p+=(O.a=F=k[h+3])*A,w+=b,x+=P,S+=T,C+=F,O=O.next;for(B=U,H=E,a=0;D>a;a++)k[l+3]=F=p*z>>W,0!==F?(F=255/F,k[l]=(d*z>>W)*F,k[l+1]=(f*z>>W)*F,k[l+2]=(g*z>>W)*F):k[l]=k[l+1]=k[l+2]=0,d-=v,f-=m,g-=_,p-=y,v-=B.r,m-=B.g,_-=B.b,y-=B.a,h=u+((h=a+n+1)<R?h:R)<<2,w+=B.r=k[h],x+=B.g=k[h+1],S+=B.b=k[h+2],C+=B.a=k[h+3],d+=w,f+=x,g+=S,p+=C,B=B.next,v+=b=H.r,m+=P=H.g,_+=T=H.b,y+=F=H.a,w-=b,x-=P,S-=T,C-=F,H=H.next,l+=4;u+=D}for(a=0;D>a;a++){for(x=S=C=w=f=g=p=d=0,l=a<<2,v=M*(b=k[l]),m=M*(P=k[l+1]),_=M*(T=k[l+2]),y=M*(F=k[l+3]),d+=N*b,f+=N*P,g+=N*T,p+=N*F,O=U,o=0;M>o;o++)O.r=b,O.g=P,O.b=T,O.a=F,O=O.next;for(c=D,o=1;n>=o;o++)l=c+a<<2,d+=(O.r=b=k[l])*(A=M-o),f+=(O.g=P=k[l+1])*A,g+=(O.b=T=k[l+2])*A,p+=(O.a=F=k[l+3])*A,w+=b,x+=P,S+=T,C+=F,O=O.next,G>o&&(c+=D);for(l=a,B=U,H=E,s=0;L>s;s++)h=l<<2,k[h+3]=F=p*z>>W,F>0?(F=255/F,k[h]=(d*z>>W)*F,k[h+1]=(f*z>>W)*F,k[h+2]=(g*z>>W)*F):k[h]=k[h+1]=k[h+2]=0,d-=v,f-=m,g-=_,p-=y,v-=B.r,m-=B.g,_-=B.b,y-=B.a,h=a+((h=s+M)<G?h:G)*D<<2,d+=w+=B.r=k[h],f+=x+=B.g=k[h+1],g+=S+=B.b=k[h+2],p+=C+=B.a=k[h+3],B=B.next,v+=b=H.r,m+=P=H.g,_+=T=H.b,y+=F=H.a,w-=b,x-=P,S-=T,C-=F,H=H.next,l+=D}}var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],r=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];
n.Filters.Blur=function(t){var i=0|this.getFilterRadius();i>0&&e(t,i)},n.Factory.addFilterGetterSetter(n.Image,"filterRadius",0)}(),function(){function t(t,e,i){var n=4*(i*t.width+e),r=[];return r.push(t.data[n++],t.data[n++],t.data[n++],t.data[n++]),r}function e(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function i(t){for(var e=[0,0,0],i=0;i<t.length;i++)e[0]+=t[i][0],e[1]+=t[i][1],e[2]+=t[i][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function r(n,r){var a=t(n,0,0),s=t(n,n.width-1,0),o=t(n,0,n.height-1),h=t(n,n.width-1,n.height-1),c=r||10;if(e(a,s)<c&&e(s,h)<c&&e(h,o)<c&&e(o,a)<c){for(var l=i([s,a,h,o]),u=[],d=0;d<n.width*n.height;d++){var f=e(l,[n.data[4*d],n.data[4*d+1],n.data[4*d+2]]);u[d]=c>f?0:255}return u}}function a(t,e){for(var i=0;i<t.width*t.height;i++)t.data[4*i+3]=e[i]}function s(t,e,i){for(var n=[1,1,1,1,0,1,1,1,1],r=Math.round(Math.sqrt(n.length)),a=Math.floor(r/2),s=[],o=0;i>o;o++)for(var h=0;e>h;h++){for(var c=o*e+h,l=0,u=0;r>u;u++)for(var d=0;r>d;d++){var f=o+u-a,g=h+d-a;if(f>=0&&i>f&&g>=0&&e>g){var p=f*e+g,v=n[u*r+d];l+=t[p]*v}}s[c]=2040===l?255:0}return s}function o(t,e,i){for(var n=[1,1,1,1,1,1,1,1,1],r=Math.round(Math.sqrt(n.length)),a=Math.floor(r/2),s=[],o=0;i>o;o++)for(var h=0;e>h;h++){for(var c=o*e+h,l=0,u=0;r>u;u++)for(var d=0;r>d;d++){var f=o+u-a,g=h+d-a;if(f>=0&&i>f&&g>=0&&e>g){var p=f*e+g,v=n[u*r+d];l+=t[p]*v}}s[c]=l>=1020?255:0}return s}function h(t,e,i){for(var n=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],r=Math.round(Math.sqrt(n.length)),a=Math.floor(r/2),s=[],o=0;i>o;o++)for(var h=0;e>h;h++){for(var c=o*e+h,l=0,u=0;r>u;u++)for(var d=0;r>d;d++){var f=o+u-a,g=h+d-a;if(f>=0&&i>f&&g>=0&&e>g){var p=f*e+g,v=n[u*r+d];l+=t[p]*v}}s[c]=l}return s}n.Filters.Mask=function(t){var e=this.getFilterThreshold(),i=r(t,e);return i&&(i=s(i,t.width,t.height),i=o(i,t.width,t.height),i=h(i,t.width,t.height),a(t,i)),t},n.Factory.addFilterGetterSetter(n.Image,"filterThreshold",0)}(),function(){var t=function(t,e,i){t/=255,e/=255,i/=255;var n=Math.max(t,e,i),r=Math.min(t,e,i),a=n-r,s=a/2,o=a/(1-Math.abs(2*s-1)),h=0;return n==t?h=(e-i)/a%6:n==e?h=(i-t)/a+2:n==i&&(h=(t-e)/a+4),[(60*h+360)%360,o,s]},e=function(t,e,i,n){t/=255,e/=255,i/=255;var r=Math.max(t,e,i),a=Math.min(t,e,i),s=r-a,o=s/2,h=(s/(1-Math.abs(2*o-1)),0);r==t?h=(e-i)/s%6:r==e?h=(i-t)/s+2:r==i&&(h=(t-e)/s+4),h*=60,h%=360,h+=n,h%=360,h/=60;var c=0,l=0,u=0,d=s*(1-Math.abs(h%2-1)),f=o-s/2;return h>=0&&1>h?(c=s,l=d):h>=1&&2>h?(l=s,c=d):h>=2&&3>h?(l=s,u=d):h>=3&&4>h?(u=s,l=d):h>=4&&5>h?(u=s,c=d):h>=5&&6>h&&(c=s,u=d),c+=f,l+=f,u+=f,c=255*c,l=255*l,u=255*u,[c,l,u]},i=function(t,i){for(var n,r=t.data,a=0;a<r.length;a+=4)n=e(r[a+0],r[a+1],r[a+2],i),r[a+0]=n[0],r[a+1]=n[1],r[a+2]=n[2]};n.Filters.ShiftHue=function(t){i(t,this.getFilterHueShiftDeg()%360)},n.Factory.addFilterGetterSetter(n.Image,"filterHueShiftDeg",0),n.Filters.Colorize=function(e){for(var n=e.data,r=this.getFilterColorizeColor(),a=t(r[0],r[1],r[2]),s=a[0],o=0;o<n.length;o+=4)n[o+1]=0,n[o+2]=0;i(e,s)},n.Factory.addFilterGetterSetter(n.Image,"filterColorizeColor",[255,0,0])}(),function(){var t=function(t,e){var i=t.data,n=t.width,r=t.height,a=n*r,s=[];s.length=4*n*r;var o,h,c,l,u,d,f,g,p,v,m,_=e.length,y=e[0].length,w=Math.floor(e.length/2),x=Math.floor(e[0].length/2);for(d=0;r>d;d+=1)for(u=0;n>u;u+=1){for(o=0,h=0,c=0,l=0,v=0;_>v;v+=1)for(m=0;y>m;m+=1)f=(u+v-w)%n,f=f>0?f:-f,g=(d+v-x)%r,g=g>0?g:-g,p=4*(g*n+f),o+=e[m][v]*i[p+0],h+=e[m][v]*i[p+1],c+=e[m][v]*i[p+2];p=4*(d*n+u),s[p+0]=o,s[p+1]=h,s[p+2]=c}var S=4*a;for(p=0;S>p;p+=4)i[p+0]=s[p+0],i[p+1]=s[p+1],i[p+2]=s[p+2]},e=function(t,e,i){var n=t-e;return Math.pow(Math.E,-n*n/(2*i*i))},i=function(t,i,n){0===t%2&&(t+=1);var r,a,s,o=[];for(r=0;t>r;r+=1){for(s=[],a=0;t>a;a+=1)s.push(i*e(r,t/2,n)*e(a,t/2,n));o.push(s)}return o},r=function(t,e){var n=i(t,e,1),r=Math.floor(t/2);return n[r][r]+=1-e,n},a=function(t,e){var n=i(t,-e,1),r=Math.floor(t/2);return n[r][r]+=1+e,n};n.Factory.addFilterGetterSetter(n.Image,"filterAmount",50),n.Filters.UnsharpMask=function(e){t(e,a(5,this.getFilterAmount()/100))},n.Filters.SoftBlur=function(e){t(e,r(5,this.getFilterAmount()/100))},n.Filters.Edge=function(e){var i=this.getFilterAmount()/100;0!==i&&t(e,[[0,-1*i,0],[-1*i,1-i+4*i,-1*i],[0,-1*i,0]])},n.Filters.Emboss=function(e){var i=this.getFilterAmount()/100;0!==i&&t(e,[[-1*i,-.5*i,0],[-.5*i,1+.5*i,.5*i],[0,.5*i,1*i]])}}(),function(t,e,i,n,r,a){function s(i){if("[object Array]"===Object.prototype.toString.apply(i)){if("string"==typeof i[0]&&"function"==typeof s[i[0]])return new s[i[0]](i.slice(1,i.length));if(4===i.length)return new s.RGB(i[0]/255,i[1]/255,i[2]/255,i[3]/255)}else if("string"==typeof i){var n=i.toLowerCase();c[n]&&(i="#"+c[n]),"transparent"===n&&(i="rgba(0,0,0,0)");var r=i.match(f);if(r){var a=r[1].toUpperCase(),o=l(r[8])?r[8]:t(r[8]),h="H"===a[0],u=r[3]?100:h?360:255,d=r[5]||h?100:255,g=r[7]||h?100:255;if(l(s[a]))throw new Error("one.color."+a+" is not installed.");return new s[a](t(r[2])/u,t(r[4])/d,t(r[6])/g,o)}i.length<6&&(i=i.replace(/^#?([0-9a-f])([0-9a-f])([0-9a-f])$/i,"$1$1$2$2$3$3"));var p=i.match(/^#?([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i);if(p)return new s.RGB(e(p[1],16)/255,e(p[2],16)/255,e(p[3],16)/255)}else if("object"==typeof i&&i.isColor)return i;return!1}function o(t,e,r){function a(t,e){var n={};n[e.toLowerCase()]=new i("return this.rgb()."+e.toLowerCase()+"();"),s[e].propertyNames.forEach(function(t){n[t]=n["black"===t?"k":t[0]]=new i("value","isDelta","return this."+e.toLowerCase()+"()."+t+"(value, isDelta);")});for(var r in n)n.hasOwnProperty(r)&&void 0===s[t].prototype[r]&&(s[t].prototype[r]=n[r])}s[t]=new i(e.join(","),"if (Object.prototype.toString.apply("+e[0]+") === '[object Array]') {"+e.map(function(t,i){return t+"="+e[0]+"["+i+"];"}).reverse().join("")+"}"+"if ("+e.filter(function(t){return"alpha"!==t}).map(function(t){return"isNaN("+t+")"}).join("||")+"){"+'throw new Error("['+t+']: Invalid color: ("+'+e.join('+","+')+'+")");}'+e.map(function(t){return"hue"===t?"this._hue=hue<0?hue-Math.floor(hue):hue%1":"alpha"===t?"this._alpha=(isNaN(alpha)||alpha>1)?1:(alpha<0?0:alpha);":"this._"+t+"="+t+"<0?0:("+t+">1?1:"+t+")"}).join(";")+";"),s[t].propertyNames=e;var o=s[t].prototype;["valueOf","hex","hexa","css","cssa"].forEach(function(e){o[e]=o[e]||("RGB"===t?o.hex:new i("return this.rgb()."+e+"();"))}),o.isColor=!0,o.equals=function(i,r){l(r)&&(r=1e-10),i=i[t.toLowerCase()]();for(var a=0;a<e.length;a+=1)if(n.abs(this["_"+e[a]]-i["_"+e[a]])>r)return!1;return!0},o.toJSON=new i("return ['"+t+"', "+e.map(function(t){return"this._"+t},this).join(", ")+"];");for(var c in r)if(r.hasOwnProperty(c)){var u=c.match(/^from(.*)$/);u?s[u[1].toUpperCase()].prototype[t.toLowerCase()]=r[c]:o[c]=r[c]}o[t.toLowerCase()]=function(){return this},o.toString=new i('return "[one.color.'+t+':"+'+e.map(function(t,i){return'" '+e[i]+'="+this._'+t}).join("+")+'+"]";'),e.forEach(function(t){o[t]=o["black"===t?"k":t[0]]=new i("value","isDelta","if (typeof value === 'undefined') {return this._"+t+";"+"}"+"if (isDelta) {"+"return new this.constructor("+e.map(function(e){return"this._"+e+(t===e?"+value":"")}).join(", ")+");"+"}"+"return new this.constructor("+e.map(function(e){return t===e?"value":"this._"+e}).join(", ")+");")}),h.forEach(function(e){a(t,e),a(e,t)}),h.push(t)}var h=[],c={},l=function(t){return"undefined"==typeof t},u=/\s*(\.\d+|\d+(?:\.\d+)?)(%)?\s*/,d=/\s*(\.\d+|\d+(?:\.\d+)?)\s*/,f=new RegExp("^(rgb|hsl|hsv)a?\\("+u.source+","+u.source+","+u.source+"(?:,"+d.source+")?"+"\\)$","i");s.installMethod=function(t,e){h.forEach(function(i){s[i].prototype[t]=e})},o("RGB",["red","green","blue","alpha"],{hex:function(){var t=(65536*r(255*this._red)+256*r(255*this._green)+r(255*this._blue)).toString(16);return"#"+"00000".substr(0,6-t.length)+t},hexa:function(){var t=r(255*this._alpha).toString(16);return"#"+"00".substr(0,2-t.length)+t+this.hex().substr(1,6)},css:function(){return"rgb("+r(255*this._red)+","+r(255*this._green)+","+r(255*this._blue)+")"},cssa:function(){return"rgba("+r(255*this._red)+","+r(255*this._green)+","+r(255*this._blue)+","+this._alpha+")"}}),"undefined"!=typeof module?module.exports=s:"function"!=typeof define||l(define.amd)?"undefined"!=typeof jQuery&&l(jQuery.color)?jQuery.color=s:(one=window.one||{},one.color=s):define([],function(){return s}),o("HSV",["hue","saturation","value","alpha"],{rgb:function(){var t,e,i,r=this._hue,o=this._saturation,h=this._value,c=a(5,n.floor(6*r)),l=6*r-c,u=h*(1-o),d=h*(1-l*o),f=h*(1-(1-l)*o);switch(c){case 0:t=h,e=f,i=u;break;case 1:t=d,e=h,i=u;break;case 2:t=u,e=h,i=f;break;case 3:t=u,e=d,i=h;break;case 4:t=f,e=u,i=h;break;case 5:t=h,e=u,i=d}return new s.RGB(t,e,i,this._alpha)},hsl:function(){var t,e=(2-this._saturation)*this._value,i=this._saturation*this._value,n=1>=e?e:2-e;return t=1e-9>n?0:i/n,new s.HSL(this._hue,t,e/2,this._alpha)},fromRgb:function(){var t,e=this._red,i=this._green,r=this._blue,o=n.max(e,i,r),h=a(e,i,r),c=o-h,l=0===o?0:c/o,u=o;if(0===c)t=0;else switch(o){case e:t=(i-r)/c/6+(r>i?1:0);break;case i:t=(r-e)/c/6+1/3;break;case r:t=(e-i)/c/6+2/3}return new s.HSV(t,l,u,this._alpha)}}),o("HSL",["hue","saturation","lightness","alpha"],{hsv:function(){var t,e=2*this._lightness,i=this._saturation*(1>=e?e:2-e);return t=1e-9>e+i?0:2*i/(e+i),new s.HSV(this._hue,t,(e+i)/2,this._alpha)},rgb:function(){return this.hsv().rgb()},fromRgb:function(){return this.hsv().hsl()}})}(parseFloat,parseInt,Function,Math,Math.round,Math.min),r=function(t,e,i){return i}(n,i,"undefined"==typeof r?{}:r),r=function(t,e,i){return i}(n,i,"undefined"==typeof r?{}:r),r=function(t,e,i){return i.DIRECTION={UP:1,RIGHT:2,DOWN:3,LEFT:4},i.DIRECTION.__proto__={},i.DIRECTION.__proto__.getAll=function(){var t=i.DIRECTION;return Object.keys(t).map(function(e){return t[e]})},i.DIRECTION.__proto__.fromValue=function(t){for(var e=i.DIRECTION,n=e.getAll(),r=0,a=n.length;a>r;r++){var s=n[r],o=s==Number(t);if(o)return s}var h=t&&String(t).toUpperCase();return e[h]||null},i.DIRECTION.__proto__.isForward=function(t){switch(t){case i.DIRECTION.RIGHT:case i.DIRECTION.DOWN:return!0}return!1},i}(n,i,r),r=function(t,e,i){function n(e){var i=new t.Group,n=new t.Rect(r(e,{fill:e["background-color"]||"#FFF"}));return i.add(n),i.z=1,i}var r=e.copy;return e.Vector,i.Page=e.define({init:function(e){var i=this,r=e.width,a=e.height;i.drawables=new t.Group,i.drawables.setWidth(r),i.drawables.setHeight(a),i.id=e.id,i.top=e.top,i.left=e.left,i.background=n({x:e.left,y:e.top,width:r,height:a}),i.drawables.add(i.background)},attrAccessor:"prev,next".split(","),properties:{scrollTop:0,scrollLeft:0,_prev:null,_next:null,move:function(t,e){for(var i=this,n=i.drawables.children,r=0;r<n.length;r++){var a=n[r],s=a.z;a.setY(a.getY()-e*s),a.setX(a.getX()-t*s)}},scrollTo:function(t,e){var i=this,n=t-i.scrollLeft,r=e-i.scrollTop;i.scrollLeft=t,i.scrollTop=e,i.move(n,r)},resize:function(){}}}),i}(n,i,r),r=function(t,e,i){var n=i.Page,r=(e.copy,e.Vector,i.DIRECTION);return i.Slideshow=e.define({init:function(e){var i=this;i.stage=new t.Stage(e.stage);var a=new t.Layer;i.stage.add(a);var s=0,o=0,h=null;i.pages=e.pages.map(function(t){t.top=s,t.left=o;var e=t.height,a=t.width;switch(i._direction){case r.DOWN:s+=e;break;case r.UP:s-=e;break;case r.LEFT:o-=a;break;case r.RIGHT:o+=a}var c=new n(t);return h&&(h.next(c),c.prev(h)),h=c,(t.items||[]).forEach(function(t){c.drawables.add(t)}),c.drawIndex=t.drawIndex,c}),i.pages.sort(function(t,e){return t.drawIndex-e.drawIndex}).map(function(t){return t.drawables}).forEach(function(t){a.add(t)}),i._currentPage=i.pages.length&&i.pages[0],i.stage.draw()},attrAccessor:"direction,currentPage,onPageChange".split(","),properties:{_currentPage:null,_direction:i.DIRECTION.DOWN,scrollTo:function(t,e){var i=this,n=i.pageAtPoint(t,e),r=n!==i._currentPage;if(r){var a=n&&n.id;i._currentPage=n;var s=i._onPageChange;s&&s(a)}for(var o=i.pages,h=0,c=o.length;c>h;h++){var l=o[h];l.scrollTo(t-l.left,e-l.top)}i.stage.draw()},resize:function(t,e){var i=this,n=i.stage,a=i.pages;n.setWidth(t),n.setHeight(e);for(var s=0,o=a.length;o>s;s++){var h=a[o-1-s],c=h.drawables,l={w:c.getWidth(),h:c.getHeight()};switch(i._direction){case r.RIGHT:case r.LEFT:l.h=e;break;case r.UP:case r.DOWN:l.w=t}h.resize(l.w,l.h)}n.draw()},redraw:function(){var t=this;t.stage.draw()},pageAtPoint:function(t,e){for(var i=this,n=i.pages,r=0,a=n.length;a>r;r++){var s=n[a-1-r];if(!(e<s.top-100))return s}return null},getPage:function(){for(var t=this,e=t.pages,i=0,n=e.length;n>i;i++){var r=e[i],a="id"===r.id;if(a)return r}return null},changePage:function(t){var e=this,i=e.getPage(t);if(i){var n=e._onPageChange;e._currentPage=i,n&&n(t)}},nextPage:function(){var t=this,e=t._currentPage;return e&&e.next()},prevPage:function(){var t=this,e=t._currentPage;return e&&e.prev()}}}),i}(n,i,r),r=function(t,e,i,n,r){function a(t){var e=[];if(!t)return e;for(var i=0,n=t.length;n>i;i++)e.push(t[i]);return e}function s(t){var e=f.createElement("div");return e.className="pr-stage",e.id=e.id||"pr-stage-"+s.count++,t.appendChild(e),e}function o(t){return t&&parseInt(t.replace&&t.replace(/[^\.\d]/g,""))}function h(t){return t&&t.replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})}function c(t){var e=n.getComputedStyle||f.defaultView.getComputedStyle;return e&&e(t,null)||t.currentStyle}function l(t,e){return t[e]||t[h(e)]}function u(e){var i=c(e),r=p(e.dataset||{},{x:e.offsetLeft,y:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight,padding:o(l(i,"padding-top")),fontSize:o(l(i,"font-size")),fontFamily:l(i,"font-family"),fontStyle:l(i,"font-style"),align:l(i,"text-align")}),a=new t.Group({});if("false"===r.render)return a;var s=new t.Rect(p(r,{fill:l(i,"background-color")}));a.add(s),a.add(new t.Text(p(r,{text:e.innerText||e.textContent||"",fill:l(i,"color")})));var h=e.src;if(h){var u=new t.Group({});a.add(u),n.newImage(h,function(e){u.add(new t.Image(p(r,{image:e})))})}var d=r.rotate;if(d){var f=Number(s.getX()),g=Number(s.getY()),v=s.getWidth(),m=s.getHeight();s.setOffset([v/2,m/2]),s.setX(f+v/2),s.setY(g+m/2),s.rotate(d)}return a}n=e.crossBrowser(n);var d=e.Animation,f=(n.URL,n.document);n.newImage=function(t,e){var i=new Image;i.onload=function(){e&&e(i),n.onImageLoad&&n.onImageLoad()},i.src=t},n.onImageLoad=function(){console.log("new image loaded")},n.scrollToAnimation=function(t,e,i){var r=n.scrollToAnimation;r.busy||(r.busy=!0,i||(i=200),new d({x:n.scrollX,y:n.scrollY},{x:t,y:e}).start(n.requestAnimationFrame,i,function(t){n.scrollToAnimation.busy=!1,n.scrollTo(t.x,t.y)}))};var g=e.composite,p=e.copy,v=i.Slideshow,m=i.DIRECTION;return s.count=0,i.slideshows=[],n.onload=g(n.onload,function(){var t=(e.math.min,e.math.max),o=f.getElementById("para")||f.body,h=a(o.children),c=s(o),l=m.fromValue(o.dataset.direction)||m.DOWN,d=new v({stage:{container:c.id,width:n.innerWidth,height:n.innerHeight},pages:h.map(function(e,i){var r=n.getComputedStyle(e),s=p(e.dataset||{},{}),o=t(s.width||e.scrollWidth||0,n.innerWidth),h=t(s.height||e.scrollHeight||0,n.innerHeight);switch(l){case m.LEFT:case m.RIGHT:e.style.width=o+"px";break;case m.UP:case m.DOWN:e.style.height=h+"px"}e.className=[e.className,"pr-page"].join(" "),e.id=e.id||"page-"+(i+1),s.id=e.id,s.height=h,s.width=o,s.drawIndex=s.drawIndex||i,s["background-color"]=r["background-color"];var c=a(e.children);return s.items=c.map(function(t){var e=p(t.dataset,{z:1}),i=u(t);return i.z=e.z&&Number(e.z),i}),s})}).direction(l).onPageChange(function(t){var e=f.getElementById(t);if(e){var i=c.id;e.id=r,c.id=t,location.hash=t,c.id=i,e.id=t}}),_=function(){var t=n.pageXOffset,e=n.pageYOffset;d.scrollTo(t,e)};_(),n.onscroll=g(n.onscroll,_),n.onresize=g(n.onresize,function(){d.resize(n.innerWidth,n.innerHeight)}),n.onImageLoad=function(){d.redraw()},f.addEventListener("keydown",function(t){var e=m.fromValue(t.keyIdentifier);if(e){t.preventDefault();var i=m.isForward(d._direction)==m.isForward(e),r=null;r=i?d.nextPage():d.prevPage()||d.currentPage(),r&&(d.changePage(r.id),n.scrollToAnimation(r.left,r.top))}}),i.slideshows.push(d)}),i}(n,i,r,window,void 0)}();